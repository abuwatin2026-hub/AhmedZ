# اختبار دخان (Smoke Test) — مشتروات/مخزون/تقارير/عملات متعددة (زبون أونلاين)

## المتطلبات
- تشغيل Supabase محليًا.
- تشغيل واجهة الويب.
- وجود مخزن فعال واحد على الأقل.
- وجود عملات تشغيلية + أسعار صرف (Operational FX) إذا ستختبر عملة غير العملة الأساسية.

## 1) المشتروات (Purchase Orders + الاستلام)
- افتح: الإدارة → المشتروات.
- أنشئ أمر شراء جديد لمورد.
- أضف صنفًا غذائيًا (حسب فئة/مجموعة مرتبطة بفئة غذائية).
- فعّل استلام المخزون الآن، وتأكد من ظهور حقول:
  - تاريخ الإنتاج
  - تاريخ الانتهاء
- احفظ.
- افتح أمر الشراء ثم نفّذ “استلام جزئي” لنفس الصنف وتأكد من ظهور نفس حقول التواريخ.

**النتيجة المتوقعة**
- يتم إنشاء Receipt و Batches/Inventory Movements حسب منطق النظام.
- مخزون الصنف يزيد، وتظهر الكميات في شاشة المخزون.

## 2) المخزون (Stock)
- افتح: الإدارة → المخزون.
- تأكد أن الصنف الذي استلمته يظهر بكمية متاحة > 0.
- جرّب حجز كمية عبر طلب بيع (POS) ثم راقب تغير available/reserved.

## 3) تقارير المخزون (Inventory Stock Report)
- افتح: الإدارة → التقارير → تقرير المخزون.
- جرّب فلترة حسب المخزن، حسب المجموعة، حسب الفئة.
- تأكد أن الأصناف المستلمة تظهر في التقرير.

## 4) تقارير الموردين (Supplier Stock Report)
- افتح: الإدارة → التقارير → تقرير مخزون الموردين.
- اختر نفس المورد.
- تأكد أن الأصناف تظهر حتى لو لم تكن مربوطة بـ supplier_items (Fallback من أوامر الشراء).

## 5) العملات المتعددة للزبون أونلاين
- افتح واجهة الزبون (الشاشة الرئيسية).
- تأكد أن عملة العرض الافتراضية تكون YER إذا كانت ضمن العملات التشغيلية.
- غيّر عملة العرض من القائمة (مثلاً USD) وتأكد أن أسعار المنتجات تتغير.
- انتقل للسلة ثم Checkout:
  - اختر “عملة الدفع” (Transaction Currency).
  - تأكد أن ملخص الطلب والإجمالي يظهر بنفس العملة المختارة.
- أكمل طلبًا تجريبيًا وتأكد أن بيانات الطلب تحتوي:
  - currency
  - fxRate
  - baseCurrency

## تشغيل اختبار دخان تلقائي (اختياري)
- عبر Node script:
  - `node scripts/smoke-purchases-stock-reports-onlinefx.mjs`
  - يحتاج أن تكون متغيرات البيئة موجودة (URL + ANON KEY) أو `.env.local`.
