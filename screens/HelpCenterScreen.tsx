import React, { useMemo, useState } from 'react';
import { Link, useLocation, useNavigate } from 'react-router-dom';
import { BackArrowIcon } from '../components/icons';

type HelpSection = {
  title: string;
  bullets: string[];
};

type HelpTopic = {
  title: string;
  intro: string;
  sections: HelpSection[];
};

const normalizePath = (path: string) => {
  if (path.startsWith('/item/')) return '/item/:id';
  if (path.startsWith('/promotion/')) return '/promotion/:id';
  if (path.startsWith('/order/')) return '/order/:orderId';
  if (path.startsWith('/invoice/')) return '/invoice/:orderId';
  if (path.startsWith('/admin/shift-reports/')) return '/admin/shift-reports/:shiftId';
  if (path.startsWith('/admin/import-shipments/')) return '/admin/import-shipments/:id';
  if (path.startsWith('/admin/invoice/')) return '/admin/invoice/:orderId';
  return path;
};

const normalizeSearchText = (value: string) => {
  return value
    .toLowerCase()
    .replace(/[\u0640\u064B-\u065F\u0670\u06D6-\u06ED]/g, '')
    .replace(/\s+/g, ' ')
    .trim();
};

const HelpCenterScreen: React.FC = () => {
  const location = useLocation();
  const navigate = useNavigate();

  const fromPath = (location.state as any)?.from as string | undefined;
  const mode = (location.state as any)?.mode as string | undefined;
  const isAdminGuide = mode === 'adminGuide';
  const [query, setQuery] = useState('');
  const normalizedFrom = useMemo(() => normalizePath(fromPath || ''), [fromPath]);

  const helpTopics: Record<string, HelpTopic> = useMemo(() => {
    const topics: Record<string, HelpTopic> = {
      '/': {
        title: 'الرئيسية',
        intro: 'هذه الصفحة هي نقطة البداية لتصفح المنتجات والبحث عنها ومشاهدة العروض والبدء في الطلب.',
        sections: [
          {
            title: 'مكوّنات الصفحة',
            bullets: [
              'شريط العروض/الإعلانات: يعرض العروض وقد يوجّهك لفئة أو صنف.',
              'البحث: ابحث بالاسم أو جزء منه للوصول بسرعة.',
              'الفئات: اختر فئة لتصفية المنتجات.',
              'أصناف مميزة: عرض سريع لأهم الأصناف.',
              'اطلبها مجددًا: تظهر عند تسجيل الدخول من آخر طلباتك.',
            ],
          },
          {
            title: 'كيف تبدأ الطلب',
            bullets: [
              'اختر صنفًا لفتح صفحة التفاصيل ثم أضفه للسلة.',
              'استخدم البحث أو الفئات للوصول بسرعة.',
              'يمكنك فتح السلة في أي وقت لمراجعة الأصناف وإتمام الطلب.',
            ],
          },
          {
            title: 'نصائح للتصفح أسرع',
            bullets: [
              'إذا لم تظهر منتجات: جرّب تحديث الصفحة أو انتظر ثواني لتمام تحميل البيانات.',
              'إذا فتحت صفحة صنف من إعلان: ارجع للخلف للعودة لنفس مكانك في الرئيسية.',
            ],
          },
          {
            title: 'القائمة السفلية والأزرار',
            bullets: [
              'القائمة السفلية: الرئيسية، السلة، طلباتي، ملفي.',
              'زر المساعدة في الرأس يعرض شرح الصفحة الحالية.',
              'قائمة الرأس: لوحة التحكم، تبديل الوضع الليلي/النهاري، حمل التطبيق.',
            ],
          },
        ],
      },
      '/download-app': {
        title: 'تحميل التطبيق',
        intro: 'كيفية تثبيت التطبيق على أجهزة أندرويد وآيفون.',
        sections: [
          {
            title: 'أندرويد',
            bullets: [
              'حمل ملف التطبيق مباشرة من صفحة التحميل.',
              'افتح الملف، وقد يطلب منك النظام السماح بالتثبيت من مصادر غير معروفة.',
              'اتبع التعليمات حتى يظهر التطبيق في قائمة تطبيقاتك.',
            ],
          },
          {
            title: 'آيفون',
            bullets: [
              'افتح الموقع في متصفح سفاري.',
              'اضغط زر المشاركة في الأسفل.',
              'اختر "إضافة إلى الشاشة الرئيسية".',
              'سيظهر التطبيق كأيقونة مستقلة ويعمل بكفاءة عالية.',
            ],
          },
        ],
      },
      '/item/:id': {
        title: 'تفاصيل الصنف',
        intro: 'هنا تستطيع مشاهدة تفاصيل الصنف وتخصيصه قبل الإضافة للسلة.',
        sections: [
          {
            title: 'الأسعار والمخزون',
            bullets: [
              'السعر يظهر مع وحدة القياس (إن وُجدت).',
              'في حال نفاد المخزون ستظهر علامة "نفذت الكمية" ويتعطل زر الإضافة.',
              'قد يظهر تنبيه "متبقي" عندما تكون الكمية قليلة.',
              'قد يظهر تاريخ الإنتاج/الانتهاء ومستوى الطزاجة إن كانت متوفرة.',
              'السعر النهائي قد يتغير حسب الدرجة والإضافات والكمية/الوزن، وقد يتغير المتاح مع الطلبات والاستلام.',
            ],
          },
          {
            title: 'التخصيص',
            bullets: [
              'اختيار الدرجة: يغيّر السعر بمعامل (×) حسب الدرجة.',
              'اختيار الإضافات الافتراضية: يمكنك إيقاف/تشغيل المكونات الافتراضية.',
              'الإضافات الإضافية: يمكنك زيادة/تقليل كمية كل إضافة.',
              'الكمية/الوزن: بعض المنتجات تكون بالوزن (زيادة/نقصان 0.5)، وأخرى بالعدد.',
              'إذا كانت الإضافة لها سعر: ستُضاف تلقائيًا إلى الإجمالي حسب الكمية.',
            ],
          },
          {
            title: 'الإضافة للسلة',
            bullets: [
              'زر "أضف للسلة" يحفظ اختياراتك (الدرجة/الإضافات/الكمية أو الوزن).',
              'بعد الإضافة تظهر رسالة نجاح قصيرة.',
              'إذا أضفت نفس الصنف أكثر من مرة فقد يظهر كسطر جديد لأن اختياراته مختلفة.',
            ],
          },
          {
            title: 'مشاكل شائعة',
            bullets: [
              'زر الإضافة غير نشط: غالبًا بسبب نفاد الكمية أو عدم اختيار خيارات مطلوبة (إن وجدت).',
              'الصورة لا تظهر: تأكد من اتصالك بالإنترنت أو جرّب تحديث الصفحة.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'حقل الدرجة (إن وُجد): اختيار الدرجة يؤثر على السعر.',
              'مجموعة الإضافات: مفاتيح تشغيل/إيقاف ومربعات زيادة/نقصان الكمية لكل إضافة.',
              'حقل الوزن/الكمية: إدخال دقيق بحسب وحدة الصنف (وزن/عدد).',
              'زر إضافة للسلة: يحفظ كل الاختيارات الحالية.',
              'زر الرجوع: يعود للصفحة السابقة.',
            ],
          },
        ],
      },
      '/promotion/:id': {
        title: 'تفاصيل العرض',
        intro: 'هذه الصفحة تعرض تفاصيل عرض نشط (Bundle) ويمكنك إضافة العرض للسلة بعد تحديد الكمية.',
        sections: [
          {
            title: 'محتوى العرض',
            bullets: [
              'اسم العرض وصورته (إن وُجدت).',
              'قائمة الأصناف داخل العرض مع الكميات لكل صنف.',
              'قد يظهر السعر الأصلي مشطوبًا والسعر النهائي للعرض عند تفعيله.',
              'قد يظهر عداد وقت متبقي لانتهاء العرض عندما يكون مفعلًا.',
            ],
          },
          {
            title: 'إضافة العرض للسلة',
            bullets: [
              'حدد كمية العرض (Bundle Qty) ثم اضغط “أضف إلى السلة”.',
              'بعد الإضافة سيتم نقلك إلى السلة لمراجعة التفاصيل.',
              'إذا كان العرض غير مفعل سيظهر تنبيه ولا يمكن إضافته.',
            ],
          },
          {
            title: 'ملاحظات',
            bullets: [
              'سعر العرض يُحسب من الخادم حسب قواعد العروض والخصومات الفعالة.',
              'قد تتغير تفاصيل العرض إذا انتهت صلاحيته أو تم تعطيله.',
            ],
          },
        ],
      },
      '/cart': {
        title: 'السلة',
        intro: 'تجمع هذه الصفحة أصنافك قبل إتمام الطلب وتعرض الحسابات والخصومات.',
        sections: [
          {
            title: 'عناصر السلة',
            bullets: [
              'لكل صنف: صورة، اسم، (درجة إن وُجدت)، إضافات، وسعر فرعي.',
              'للأصناف غير المعتمدة على الوزن: يمكنك زيادة/نقصان الكمية.',
              'للأصناف المعتمدة على الوزن: يعرض الوزن ولا تظهر أزرار الكمية هنا.',
              'يمكنك إزالة الصنف من السلة عبر زر الحذف.',
              'عند تغيير الكمية يتم تحديث الملخص تلقائيًا.',
            ],
          },
          {
            title: 'كوبون الخصم',
            bullets: [
              'أدخل الكود ثم اضغط "تطبيق".',
              'عند تفعيل الكوبون يظهر الخصم ويمكن إزالة الكوبون.',
              'إذا كان الكود غير صحيح ستظهر رسالة بعدم صلاحيته.',
              'الكوبون قد يكون نسبة مئوية أو مبلغ ثابت حسب إعداداته.',
            ],
          },
          {
            title: 'ملخص الطلب',
            bullets: [
              'يعرض: المجموع الفرعي، الخصم (إن وجد)، رسوم التوصيل، والإجمالي.',
              'الضريبة (إن كانت مفعّلة) تُحسب وتُعرض كسطر منفصل.',
              'زر "المتابعة لإتمام الطلب" ينقلك لصفحة الدفع.',
              'رسوم التوصيل قد تتغير حسب منطقة التوصيل المختارة في صفحة الإتمام.',
            ],
          },
          {
            title: 'قبل الإتمام',
            bullets: [
              'تأكد من أن السلة ليست فارغة قبل الانتقال.',
              'إذا عدت من صفحة الإتمام ستجد السلة كما تركتها.',
            ],
          },
          {
            title: 'الأزرار والحقول',
            bullets: [
              'حقل كود الخصم: يقبل نص الكود ويُعطّل عند تطبيق كوبون نشط.',
              'زر تطبيق: يفعّل الكوبون إن كان صالحًا.',
              'زر إزالة الكوبون: يحذف الكوبون ويعيد الحسابات.',
              'أزرار +/–: لزيادة/نقصان كمية الأصناف غير الوزنية.',
              'زر الحذف: يزيل السطر من السلة.',
              'زر متابعة التسوق: يعود للرئيسية.',
              'زر المتابعة لإتمام الطلب: يفتح صفحة الإتمام.',
            ],
          },
        ],
      },
      '/checkout': {
        title: 'إتمام الطلب',
        intro: 'هذه الصفحة تجمع بيانات العميل والتوصيل والدفع وتؤكد إنشاء الطلب.',
        sections: [
          {
            title: 'بيانات العميل والعنوان',
            bullets: [
              'الحقول المطلوبة: اسم الزبون، رقم الهاتف، عنوان التوصيل.',
              'تعليمات التوصيل اختيارية لمساعدة المندوب.',
              'زر "استخدام موقعي الحالي" يحفظ الإحداثيات (اختياري).',
              'يمكن حفظ العنوان (للمستخدم المسجل) وإعادة اختياره أو حذفه.',
              'اكتب عنوانًا واضحًا مع معلم قريب لتسهيل الوصول.',
            ],
          },
          {
            title: 'مناطق التوصيل والموقع',
            bullets: [
              'يقوم التطبيق بالكشف التلقائي عن مكانك واقتراح المنطقة المناسبة.',
              'يمكنك استخدام الخريطة التفاعلية لتعديل مكان الاستلام بدقة.',
              'إذا كان موقعك خارج المنطقة المختارة سيظهر تنبيه.',
              'يمكن الجدولة لوقت لاحق مع اختيار تاريخ ووقت في المستقبل.',
            ],
          },
          {
            title: 'طريقة الدفع',
            bullets: [
              'اختر طريقة الدفع المتاحة حسب إعدادات المتجر.',
              'في الدفع عبر الحسابات البنكية: يجب رفع صورة إشعار أو إدخال رقم العملية.',
              'إن كانت "حوالات" متاحة: اخترها واتبّع تعليمات المندوب عند التسليم.',
            ],
          },
          {
            title: 'الخصومات والنقاط',
            bullets: [
              'قد تُطبق خصومات: كوبون، خصم المستوى، خصم الدعوة، خصم استبدال النقاط.',
              'الإجمالي النهائي = بعد الخصومات + رسوم التوصيل الفعلية.',
              'استبدال النقاط (إن كان مفعّلًا): يقلل الإجمالي حسب قيمة النقطة.',
            ],
          },
          {
            title: 'تأكيد الطلب',
            bullets: [
              'زر "تأكيد الطلب" ينشئ الطلب وينقلك لصفحة تتبع الطلب.',
              'عند وجود خطأ ستظهر رسالة توضح المطلوب.',
              'بعد إنشاء الطلب ستحصل على نقاط كسب (حسب الإعدادات) عند اكتمال الطلب.',
            ],
          },
          {
            title: 'ملاحظات مهمة',
            bullets: [
              'قد يتم تعديل وقت الوصول حسب ضغط الطلبات وحالة الطريق.',
              'إذا أدخلت رقم هاتف خاطئ قد يتعذر على المندوب التواصل معك.',
            ],
          },
          {
            title: 'الحقول التفصيلية',
            bullets: [
              'اسم العميل: نص إلزامي.',
              'رقم الهاتف: رقم إلزامي بصيغة صحيحة.',
              'العناوين المحفوظة: اختيار/حذف/حفظ العنوان الحالي.',
              'العنوان النصي: وصف واضح لمكان التسليم (إلزامي).',
              'استخدام موقعي الحالي: يلتقط الإحداثيات ويفتح الخريطة.',
              'عرض/إخفاء الخريطة: لتعديل الموقع يدويًا.',
              'مسح الموقع: لإزالة الإحداثيات المخزنة.',
              'منطقة التوصيل: قائمة منسوبة برسوم وزمن وصول.',
              'وقت التوصيل: الآن أو جدولة لتاريخ لاحق.',
              'ملاحظات: نص اختياري عن الطلب.',
              'طريقة الدفع: نقد/حسابات بنكية/حوالات حسب الإعدادات المتاحة.',
              'بيانات التحويل: اختيار البنك أو المستلم، رقم العملية أو رفع صورة إشعار.',
            ],
          },
          {
            title: 'الأزرار والتحقق',
            bullets: [
              'حفظ هذا العنوان: يخزن العنوان مشفّرًا لدى الحساب.',
              'اختيار هذا العنوان/حذف: لإدارة العناوين المحفوظة.',
              'تأكيد الطلب: يُرسل الطلب بعد اجتياز التحقق.',
              'رسائل التحقق: اسم/هاتف/عنوان مطلوب؛ منطقة صحيحة؛ إثبات دفع عند التحويل؛ الموقع داخل نطاق المنطقة.',
            ],
          },
        ],
      },
      '/order/:orderId': {
        title: 'تتبع الطلب',
        intro: 'تتابع هنا حالة طلبك من الاستلام وحتى التسليم، مع ملخص للطلب.',
        sections: [
          {
            title: 'حالة الطلب',
            bullets: [
              'يعرض مراحل الحالة: قيد الانتظار → التحضير → في الطريق → تم التسليم.',
              'قد يظهر مؤقت وصول تقديري عندما تصبح الحالة "في الطريق".',
              'في الطلبات المجدولة يظهر وقت الجدولة.',
              'عند الإلغاء يظهر سبب/وصف حالة الإلغاء.',
            ],
          },
          {
            title: 'رمز التسليم',
            bullets: [
              'إذا ظهر "رمز التسليم" شاركه فقط عند استلام الطلب.',
            ],
          },
          {
            title: 'ملخص الطلب والفاتورة',
            bullets: [
              'يعرض الأصناف والإضافات والإجمالي المدفوع.',
              'زر "عرض الفاتورة" ينقلك إلى الفاتورة.',
            ],
          },
          {
            title: 'الأزرار',
            bullets: [
              'زر تتبع/تحديث الحالة: يعرض الحالة الحالية.',
              'زر عرض الفاتورة: متاح بعد إصدار الفاتورة.',
            ],
          },
        ],
      },
      '/my-orders': {
        title: 'طلباتي',
        intro: 'تجد هنا سجل طلباتك مع خيارات إعادة الطلب والتقييم وتتبع الطلب.',
        sections: [
          {
            title: 'سجل الطلبات',
            bullets: [
              'كل بطاقة تعرض رقم الطلب وتاريخه والحالة والإجمالي.',
              'زر "تتبع الطلب" يفتح صفحة التتبع.',
              'زر "اطلبها مجددًا" يضيف نفس الأصناف للسلة.',
              'بعد التسليم قد يظهر زر "تقييم الطلب" للحصول على النقاط.',
              'زر "الفاتورة" يتاح فقط عند إصدار الفاتورة.',
            ],
          },
          {
            title: 'الولاء',
            bullets: [
              'تظهر بطاقة مستوى الولاء ونقاطك.',
            ],
          },
          {
            title: 'الأزرار الأساسية',
            bullets: [
              'تتبع الطلب: فتح صفحة التتبع للحالة.',
              'اطلبها مجددًا: إعادة إضافة الأصناف للسلة.',
              'تقييم: فتح نافذة التقييم (إن كانت متاحة).',
              'الفاتورة: عرض/مشاركة/طباعة الفاتورة بعد الإصدار.',
            ],
          },
        ],
      },
      '/profile': {
        title: 'ملفي الشخصي',
        intro: 'تحديث بياناتك، متابعة الولاء والتحديات، ومشاركة كود الدعوة.',
        sections: [
          {
            title: 'الملف والبيانات',
            bullets: [
              'يمكن تغيير الاسم والصورة (عبر اختيار صورة جديدة).',
              'رقم الهاتف/البريد مرتبط بالحساب ولا يمكن تغييره هنا.',
              'زر "حفظ التغييرات" يحدث البيانات ويظهر إشعار نجاح.',
            ],
          },
          {
            title: 'التحديات والولاء',
            bullets: [
              'تعرض التحديات التقدم ويمكن استلام المكافأة عند الاكتمال.',
              'يمكن مشاركة كود الدعوة لكسب مكافآت.',
            ],
          },
          {
            title: 'تسجيل الخروج',
            bullets: [
              'زر "تسجيل الخروج" ينهي الجلسة ويعيدك للرئيسية.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'حقل الاسم: تعديل وإرسال.',
              'صورة الملف: اختيار صورة جديدة.',
              'بطاقات الولاء والتحديات: عرض نقاطك والمستوى والتقدم.',
              'كود الدعوة: نسخ ومشاركة.',
              'حفظ التغييرات: تحديث الملف.',
            ],
          },
        ],
      },
      '/invoice/:orderId': {
        title: 'الفاتورة',
        intro: 'تُعرض هنا فاتورة الطلب ويمكن طباعتها أو مشاركتها PDF.',
        sections: [
          {
            title: 'عرض الفاتورة',
            bullets: [
              'إذا لم تُصدر الفاتورة بعد ستظهر رسالة توضح أن الفاتورة غير متاحة.',
              'زر الرجوع يعيدك للصفحة السابقة.',
              'عند تفعيل الضريبة تظهر نسبة الضريبة والرقم الضريبي في الفاتورة.',
            ],
          },
          {
            title: 'مشاركة/طباعة',
            bullets: [
              'زر "مشاركة PDF" ينشئ ملف PDF لمشاركة/حفظ الفاتورة.',
              'زر "طباعة" يطبع الفاتورة (وقد تُضاف علامة نسخة عند إعادة الطباعة).',
            ],
          },
          {
            title: 'الأزرار',
            bullets: [
              'مشاركة PDF: حفظ/إرسال الفاتورة.',
              'طباعة: إرسال للطابعة الحرارية/النظام.',
              'رجوع: العودة للطلب أو الصفحة السابقة.',
            ],
          },
        ],
      },
      '/login': {
        title: 'تسجيل الدخول / إنشاء حساب',
        intro: 'تسجيل الدخول برقم الهاتف (حاليًا) أو إنشاء حساب جديد. خيار جوجل قد يكون غير متاح حتى يتم تفعيل الخدمة.',
        sections: [
          {
            title: 'الدخول عبر الهاتف',
            bullets: [
              'أدخل رقم الهاتف بصيغة صحيحة (أرقام فقط) ثم كلمة المرور.',
              'إذا كان الرقم جديدًا: بدّل إلى "إنشاء حساب" ثم أدخل الاسم (إلزامي).',
              'كود الدعوة اختياري ويُستخدم للحصول على ميزة/خصم عند أول طلب حسب إعدادات المتجر.',
              'عند تكرار محاولات دخول خاطئة قد يتم قفل المحاولات مؤقتًا.',
            ],
          },
          {
            title: 'الدخول عبر جوجل',
            bullets: [
              'قد لا يظهر زر جوجل حاليًا حتى يتم تفعيل خدمة Google Login في النظام.',
              'عند تفعيلها لاحقًا: اختر حسابك ثم وافق على الصلاحيات المطلوبة.',
            ],
          },
          {
            title: 'التبديل بين الوضعين',
            bullets: [
              'يمكنك التبديل بين "تسجيل الدخول" و"إنشاء حساب".',
              'عند التبديل يتم مسح رسائل الخطأ السابقة لحماية الخصوصية.',
            ],
          },
          {
            title: 'ماذا أفعل إذا نسيت كلمة المرور؟',
            bullets: [
              'حاليًا: تواصل مع إدارة المتجر لإعادة تعيين كلمة المرور لحسابك.',
              'تأكد من كتابة كلمة المرور بنفس الأحرف والرموز بدون مسافات إضافية.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'رقم الهاتف: إدخال بصيغة صحيحة.',
              'كلمة المرور: إدخال آمن.',
              'الاسم (إنشاء حساب): يظهر عند اختيار إنشاء حساب.',
              'كود الدعوة: اختياري للمستخدم الجديد.',
              'زر تبديل: بين الدخول/إنشاء حساب.',
              'زر دخول/إنشاء: إرسال النموذج.',
            ],
          },
        ],
      },
      '/otp': {
        title: 'رمز التحقق',
        intro: 'إدخال رمز مكوّن من 6 أرقام لتأكيد رقم الهاتف.',
        sections: [
          {
            title: 'إدخال الرمز',
            bullets: [
              'اكتب الأرقام في الخانات الست، وسيتم الانتقال تلقائيًا للخانة التالية.',
              'زر التحقق ينجح فقط إذا كان الرمز صحيحًا وغير منتهي.',
              'إذا كتبت رقمًا بالخطأ يمكنك حذف آخر خانة ثم المتابعة.',
            ],
          },
          {
            title: 'إعادة الإرسال',
            bullets: [
              'يمكن إعادة إرسال الرمز بعد انتهاء العداد.',
              'زر "تغيير رقم الهاتف" يعيدك لشاشة الدخول.',
              'إذا لم يصل الرمز: تأكد من الشبكة أو انتظر دقيقة ثم أعد الإرسال.',
            ],
          },
          {
            title: 'ملاحظات أمنية',
            bullets: [
              'لا تشارك رمز التحقق مع أي شخص.',
              'إذا اشتبهت بمحاولة دخول غير معروفة: غيّر كلمة المرور فورًا.',
            ],
          },
          {
            title: 'الأزرار',
            bullets: [
              'تحقق: تأكيد الرمز.',
              'إعادة إرسال: إرسال رمز جديد بعد انتهاء العداد.',
              'تغيير رقم الهاتف: العودة وإدخال رقم جديد.',
            ],
          },
        ],
      },
      '/admin/dashboard': {
        title: 'لوحة التحكم',
        intro: 'تعرض هذه الصفحة نظرة سريعة على الطلبات الحالية مع إمكانية تغيير الحالة.',
        sections: [
          {
            title: 'ماذا تعرض؟',
            bullets: [
              'بطاقات لكل طلب: رقم مختصر، تاريخ، حالة، أصناف، وإجمالي.',
              'قائمة لتغيير حالة الطلب مباشرة.',
              'يمكنك فتح تفاصيل الطلب لإدارة الدفع والفاتورة حسب صلاحياتك.',
            ],
          },
          {
            title: 'تسلسل الحالات المقترح',
            bullets: [
              'قيد الانتظار → التحضير → في الطريق → تم التسليم.',
              'في الطلبات المجدولة: تبقى "مجدول" حتى موعد التنفيذ ثم تنتقل للحالات الطبيعية.',
              'الإلغاء يُستخدم عند تعذر التنفيذ (نقص مخزون/تعذر تواصل/طلب مكرر).',
            ],
          },
        ],
      },
      '/admin/orders': {
        title: 'إدارة الطلبات',
        intro: 'متابعة كل الطلبات وتحديث الحالة وتعيين مندوب وإدارة الدفع والفواتير.',
        sections: [
          {
            title: 'التصفية والترتيب',
            bullets: [
              'فلترة حسب الحالة (الكل/قيد الانتظار/التحضير/في الطريق/تم التسليم/مجدول/ملغي).',
              'ترتيب حسب الأحدث أو الأقدم.',
              'قد ترى فقط طلباتك كمندوب إذا كان دورك مندوب.',
              'استخدم البحث (إن وجد) للعثور على طلب برقم الهاتف أو رقم الطلب.',
            ],
          },
          {
            title: 'أعمدة الجدول',
            bullets: [
              'بيانات الزبون تشمل العنوان وملاحظات وتعليمات توصيل وإثبات الدفع إن وجد.',
              'عرض موقع العميل في خرائط جوجل عند توفر الإحداثيات.',
              'قد يظهر مصدر الطلب: أونلاين أو بيع حضوري.',
            ],
          },
          {
            title: 'إجراءات مهمة',
            bullets: [
              'تغيير الحالة حسب الصلاحيات المتاحة لك.',
              'تأكيد التحصيل/الدفع لإصدار الفاتورة بعد التسليم.',
              'إلغاء الطلب (عند توفر صلاحية الإلغاء).',
              'تعيين مندوب أو إزالة التعيين.',
              'كمندوب: قبول مهمة التوصيل ثم تأكيد التسليم برمز التسليم عند الطلب.',
              'إضافة بيع حضوري: استخدم زر "بيع حضوري" الجديد مع دعم الإضافات.',
              'يمكنك البحث عن الأصناف بسرعة داخل نافذة البيع الحضوري.',
              'السعر المعروض في البيع الحضوري يُسعّر من الخادم عند توفر اتصال لتطبيق الشرائح/العميل والحد الأدنى للدفعات؛ بدون اتصال قد ترى سعرًا تقديريًا.',
              'في حال وجود مشكلة بالمخزون: عدّل الكمية من إدارة المخزون قبل اعتماد الطلب.',
              'التحصيل الجزئي للطلبات الحضورية يكون نقدًا فقط.',
            ],
          },
          {
            title: 'الفاتورة (متى تظهر؟)',
            bullets: [
              'عادةً تُصدر الفاتورة بعد التسليم وتأكيد الدفع/التحصيل.',
              'إعادة الطباعة قد تُسجل كنسخة إضافية حسب إعدادات النظام.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'مربع البحث/الفلاتر: تحديد الحالة والفترات.',
              'زر تعيين مندوب: ربط الطلب بمندوب.',
              'زر تغيير الحالة: التنقل عبر حالات التنفيذ.',
              'زر التحصيل/الدفع: اعتماد الدفع حسب الطريقة.',
              'زر إلغاء: إلغاء الطلب مع سبب.',
              'زر فاتورة: عرض الفاتورة عند الإصدار.',
            ],
          },
        ],
      },
      '/admin/items': {
        title: 'إدارة الأصناف',
        intro: 'إضافة وتعديل الأصناف كبيانات تعريفية للبيع (الاسم/السعر/الوحدة/الطزاجة...). لا يتم إدخال كمية المخزون من هنا؛ الكمية تتغير عبر الاستلام من المشتريات أو التسوية من إدارة المخزون. تُقفل حقول تكلفة الشراء (سعر الشراء/النقل/الضريبة) تلقائيًا بعد أول استلام للصنف لضمان سلامة متوسط التكلفة.',
        sections: [
          {
            title: 'الأصناف',
            bullets: [
              'إضافة/تعديل صنف: الاسم والوصف والسعر والصورة والفئة وحالة الصنف.',
              'يمكن تحديد صنف كمميز ليظهر في الرئيسية.',
              'إعدادات الطزاجة: تاريخ الإنتاج/الانتهاء ومستوى الطزاجة (اختياري).',
              'اختيار وحدة قياس مناسبة يساعد في ضبط الكمية/الوزن وسلوك السلة (وزني: خطوة 0.5، قطعي: خطوة 1).',
              'حقول التكلفة تُستخدم عند الاستلام لحساب متوسط التكلفة (Cost) وتقارير الربحية.',
            ],
          },
          {
            title: 'فلاتر وبحث',
            bullets: [
              'بحث نصي وتصفية حسب الفئة ووحدة القياس والطزاجة.',
              'فلاتر عامة حسب الانتهاء والطزاجة والترتيب.',
              'استخدم حالة الصنف (نشط/غير نشط/مؤرشف) لإخفاء صنف بدون حذف سجلاته.',
            ],
          },
          {
            title: 'إعدادات الميتا',
            bullets: [
              'إدارة الفئات ووحدات القياس ومستويات الطزاجة (إضافة/تعديل/حذف/تفعيل).',
              'عند تعطيل فئة/وحدة قد تختفي من خيارات إنشاء الصنف لاحقًا.',
            ],
          },
          {
            title: 'أفضل ممارسات',
            bullets: [
              'اكتب وصفًا قصيرًا وواضحًا يشرح الجودة والوزن/الكمية المتوقعة.',
              'استخدم صورة واضحة؛ هذا يزيد معدل الطلب من التطبيق.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'الاسم والوصف والسعر: بيانات أساسية للصنف.',
              'الفئة والوحدة والطزاجة: لضبط التصنيف وسلوك السلة.',
              'الصورة: رفع/تغيير صورة واضحة.',
              'حفظ/تعديل/حذف/تفعيل/تعطيل/أرشفة حسب الحاجة.',
            ],
          },
        ],
      },

      '/admin/ads': {
        title: 'إدارة الإعلانات',
        intro: 'إدارة الإعلانات التي تظهر في شريط العروض داخل التطبيق.',
        sections: [
          {
            title: 'مكوّنات الإعلان',
            bullets: [
              'الصورة: تُعرض داخل الشريط في الرئيسية.',
              'العنوان والعنوان الفرعي حسب اللغة الحالية حسب اللغة الحالية.',
              'نوع الإجراء: يحدد ماذا يحدث عند ضغط المستخدم على الإعلان.',
              'الحالة: نشط/غير نشط لتفعيل أو إخفاء الإعلان.',
              'الترتيب: يحدد ترتيب ظهور الإعلان داخل الشريط.',
            ],
          },
          {
            title: 'أنواع الإجراء',
            bullets: [
              'بدون إجراء: الإعلان للعرض فقط.',
              'صنف: يفتح صفحة صنف محدد (اختر الصنف الهدف).',
              'فئة: يفتح الرئيسية مع تصفية على فئة معينة.',
            ],
          },
          {
            title: 'الإجراءات',
            bullets: [
              'زر "إضافة إعلان" لإنشاء إعلان جديد.',
              'زر التعديل لتحديث بيانات إعلان موجود.',
              'زر الحذف لإزالة الإعلان بعد التأكيد.',
              'اجعل إعلانًا واحدًا أو أكثر نشطًا لتظهر في الرئيسية.',
            ],
          },
          {
            title: 'الحقول',
            bullets: [
              'الصورة والعنوان/العنوان الفرعي: محتوى العرض.',
              'نوع الإجراء: بدون/صنف/فئة.',
              'الحالة والترتيب: التحكم بالظهور والموقع.',
            ],
          },
        ],
      },

      '/admin/coupons': {
        title: 'إدارة الكوبونات',
        intro: 'إنشاء كوبونات خصم وتعديلها وحذفها.',
        sections: [
          {
            title: 'بيانات الكوبون',
            bullets: [
              'الكود: النص الذي يدخله العميل في السلة.',
              'النوع: نسبة مئوية أو خصم ثابت.',
              'القيمة: % في حالة النسبة، أو مبلغ بالعملة في حالة الثابت.',
              'استخدم أكواد قصيرة وواضحة لتسهيل كتابتها.',
            ],
          },
          {
            title: 'الإجراءات',
            bullets: [
              'زر "إضافة كوبون" لإنشاء كوبون جديد.',
              'زر التعديل لتحديث كوبون.',
              'زر الحذف يطلب تأكيدًا قبل الإزالة.',
              'بعد إنشاء كوبون جرّبه من السلة للتأكد أن الخصم يحسب كما تريد.',
            ],
          },
        ],
      },
      '/admin/promotions': {
        title: 'إدارة العروض الترويجية',
        intro: 'تصميم عروض مركبة قابلة للتفعيل بمدة وشروط مع محرك ترويج متقدم.',
        sections: [
          {
            title: 'أنواع العروض',
            bullets: [
              'خصم نسبة/مبلغ على صنف/فئة/السلة.',
              'اشترِ كمية واحصل على خصم/هدية.',
              'شرط منطقة التوصيل أو طريقة الدفع.',
            ],
          },
          {
            title: 'التفعيل والمدة',
            bullets: [
              'تحديد تاريخ بداية ونهاية العرض.',
              'تفعيل/تعطيل العرض بشكل فوري.',
              'إمكانية حصر العرض على شرائح عملاء محددة.',
            ],
          },
          {
            title: 'شروط الانطباق',
            bullets: [
              'حد أدنى للسلة أو للصنف.',
              'فئات معينة أو استثناءات.',
              'توافق مع الجدولة أو الطلب الحضوري.',
            ],
          },
          {
            title: 'التكديس والتعارض',
            bullets: [
              'تحديد أولوية التطبيق عند تعدد العروض.',
              'منع الجمع غير المرغوب فيه عبر قواعد التعارض.',
            ],
          },
          {
            title: 'الموافقات والتقارير',
            bullets: [
              'قد تتطلب عروض كبيرة موافقة قبل النشر.',
              'تحليل أثر العرض على المبيعات من تقارير المبيعات.',
            ],
          },
          {
            title: 'الصور والظهور',
            bullets: [
              'ارفع صورة العرض من جهازك مباشرة داخل نموذج العرض (اختياري).',
              'كما يمكنك استخدام "الإعلانات" لإظهار بنر بصري في الرئيسية وربطه بصنف/فئة مشمولة بالعرض.',
              'يفضل استخدام صورة العرض للعناصر الداخلية، وصورة الإعلان للبنرات العامة.',
            ],
          },
        ],
      },
      '/admin/sales-returns': {
        title: 'مرتجعات المبيعات',
        intro: 'إرجاع أصناف بعد البيع مع ضبط المخزون والأثر المحاسبي.',
        sections: [
          {
            title: 'الاجراء',
            bullets: [
              'اختر الطلب/الفاتورة وحدد الأصناف والكمية المرتجعة.',
              'يعود المخزون وفق السياسة ويُسجل الأثر المحاسبي تلقائياً.',
              'إعادة المبلغ للعميل حسب طريقة الدفع أو رصيد المحفظة.',
            ],
          },
          {
            title: 'القيود والحماية',
            bullets: [
              'منع المرتجع بعد فترة محددة إن وُجدت سياسة.',
              'حظر تجاوز كمية المباعة.',
              'سجل تدقيق كامل لكل عملية مرتجع.',
            ],
          },
        ],
      },
      '/admin/reviews': {
        title: 'إدارة التقييمات',
        intro: 'مراجعة تقييمات العملاء للأصناف مع فلترة وتصدير.',
        sections: [
          {
            title: 'الفلاتر والترتيب',
            bullets: [
              'فلترة حسب الصنف الذي تم تقييمه.',
              'فلترة حسب عدد النجوم.',
              'ترتيب حسب الأحدث أو الأقدم.',
              'استخدم البحث لاستخراج تقييمات صنف محدد بسرعة (إن توفر).',
            ],
          },
          {
            title: 'التصدير والمشاركة',
            bullets: [
              'زر "مشاركة PDF" ينشئ ملفًا من منطقة الطباعة.',
              'زر "تصدير إلى Excel" يحفظ CSV في المستندات عند توفر الصلاحيات.',
              'يمكن حذف تقييم عبر زر الحذف بعد التأكيد.',
              'فكّر بحذف التقييمات المسيئة أو المخالفة فقط للحفاظ على شفافية التقييمات.',
            ],
          },
        ],
      },
      '/admin/suppliers': {
        title: 'إدارة الموردين',
        intro: 'قاعدة بيانات الموردين لتسهيل عمليات الشراء والتواصل.',
        sections: [
          {
            title: 'بيانات المورد',
            bullets: [
              'الاسم ورقم الهاتف والبريد الإلكتروني.',
              'الرقم الضريبي (TIN) للفواتير الضريبية.',
              'العنوان والملاحظات الإضافية.',
            ],
          },
          {
            title: 'العملة المفضلة للمورد',
            bullets: [
              'حدد العملة التي تتعامل بها مع المورد غالبًا (اختياري).',
              'تساعد العملة المفضلة في توحيد أوامر الشراء والمدفوعات وكشوفات المورد على عملة واضحة.',
              'إذا كان المورد يتعامل بعدة عملات يمكن تركها فارغة، مع الالتزام بتحديد عملة المعاملة عند إنشاء الوثائق.',
              'الرصيد المستحق قد يُعرض مجمعًا حسب العملات (كل عملة على سطر مستقل).',
            ],
          },
          {
            title: 'الإجراءات',
            bullets: [
              'إضافة مورد جديد لاستخدامه في أوامر الشراء.',
              'تعديل بيانات المورد أو حذفه (إذا لم يكن مرتبطًا بطلبات شراء).',
              'البحث عن الموردين بالاسم أو الرقم.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'اسم المورد، وسائل التواصل، الرقم الضريبي.',
              'حفظ/تعديل/حذف.',
              'بحث سريع بالاسم/الرقم.',
            ],
          },
        ],
      },
      '/admin/supplier-credit-notes': {
        title: 'خصومات الموردين',
        intro: 'تسجيل خصم مورد (Credit Note) وتوزيعه تلقائيًا بين المخزون وCOGS.',
        sections: [
          {
            title: 'إنشاء خصم',
            bullets: [
              'حدد المورد ثم أدخل رقم استلام الشراء (Receipt ID) والمبلغ.',
              'زر "تحقق" يساعد بتحديد المورد تلقائيًا من الاستلام.',
              'يتم حفظ الخصم كـ Draft قبل الاعتماد.',
            ],
          },
          {
            title: 'الاعتماد والترحيل',
            bullets: [
              'زر "اعتماد" يطبق الخصم ويولّد قيدًا محاسبيًا تلقائيًا.',
              'الجزء المتبقي في المخزون يخفض تكلفة الدفعات (cost_per_unit).',
              'الجزء المباع يخفّض COGS بقيد محاسبي (بدون تعديل بيع سابق).',
            ],
          },
          {
            title: 'عرض التوزيع',
            bullets: [
              'زر "توزيع" يعرض تفاصيل توزيع الخصم على الدفعات والكمية قبل/بعد.',
              'قد تظهر دفعات ناتجة عن تحويلات (Source batch chain) حسب حركة المخزون.',
            ],
          },
        ],
      },
      '/admin/supplier-contracts': {
        title: 'عقود الموردين',
        intro: 'تسجيل اتفاقيات الأسعار والشروط مع الموردين لضبط التوريد والتكاليف.',
        sections: [
          {
            title: 'البيانات',
            bullets: [
              'نطاق العقد والمدة والأصناف المشمولة.',
              'أسعار متفق عليها وشروط الدفع والتسليم.',
            ],
          },
          {
            title: 'الاستخدام',
            bullets: [
              'ربط العقد بأوامر الشراء ذات الصلة.',
              'مراجعة الالتزام بالشروط في التقارير.',
            ],
          },
        ],
      },
      '/admin/supplier-evaluations': {
        title: 'تقييم الموردين',
        intro: 'قياس أداء الموردين على التسليم والجودة والسعر لدعم قرارات الشراء.',
        sections: [
          {
            title: 'المعايير',
            bullets: [
              'التسليم في الوقت، جودة البضاعة، دقة الفواتير.',
              'تكلفة إجمالية وتعاون في حل المشاكل.',
            ],
          },
          {
            title: 'القرارات',
            bullets: [
              'تحسين اختيار الموردين وإعادة التفاوض.',
              'إيقاف التعامل مع الموردين منخفضي الأداء.',
            ],
          },
        ],
      },
      '/admin/pos-test': {
        title: 'منصة اختبار POS',
        intro: 'أداة داخلية لاختبار سيناريوهات البيع الحضوري والمخزون والطباعة.',
        sections: [
          {
            title: 'الاستخدام',
            bullets: [
              'تجربة إضافة أصناف وخصومات وطرق دفع.',
              'التحقق من الطباعة الحرارية ومؤشرات المخزون.',
            ],
          },
          {
            title: 'نصائح',
            bullets: [
              'استخدمها قبل نشر تغييرات كبيرة.',
              'راجع السجلات عند ظهور سلوك غير متوقع.',
            ],
          },
        ],
      },
      '/admin/purchases': {
        title: 'أوامر الشراء',
        intro: 'إدارة دورة المشتريات من الإنشاء وحتى استلام البضاعة وتحديث المخزون.',
        sections: [
          {
            title: 'متى تستخدم أمر الشراء؟',
            bullets: [
              'عندما تريد توثيق اتفاق الشراء مع مورد محدد (الكميات، سعر الشراء، المرجع/الفاتورة، شروط الدفع).',
              'عندما تحتاج متابعة (مطلوب/مستلم/متبقي) واستلامات جزئية.',
              'عندما تريد أن تكون كل حركة زيادة مخزون مرتبطة بمصدر واضح (PO/Receipt) لضمان النزاهة والمراجعة.',
              'عندما لا توجد مصاريف شحن/تخليص كبيرة تحتاج توزيعها على التكلفة النهائية.',
            ],
          },
          {
            title: 'متى تستخدم الشحنة بدل الاعتماد على أمر الشراء فقط؟',
            bullets: [
              'عند وجود تكاليف إضافية خارج فاتورة المورد يجب تحميلها على البضاعة (نقل، تخليص، تفريغ، تأمين، رسوم...).',
              'عند تعدد الدافعين أو الفواتير المرتبطة بنفس التوريد (مورد + شركة شحن + تخليص...).',
              'عندما تريد تثبيت “التكلفة النهائية” (Landed Cost) وتحديث تكلفة المخزون والربحية بشكل صحيح بعد اكتمال كل المصاريف.',
            ],
          },
          {
            title: 'الطريقة الصحيحة (Best Practice)',
            bullets: [
              '1) أنشئ أمر شراء لكل مورد (PO) وأدخل الأصناف والكميات وسعر الشراء.',
              '2) عند وصول البضاعة: نفّذ الاستلام (Receipt) بالكمية الفعلية وتواريخ الإنتاج/الانتهاء عند الحاجة.',
              '3) إذا كانت هناك مصاريف إضافية على التوريد: أنشئ شحنة واربط بها الاستلامات ثم أدخل المصاريف.',
              '4) قبل إغلاق الشحنة: تأكد أن الاستلامات المرتبطة صحيحة وبنفس المستودع.',
              '5) أغلق الشحنة لتثبيت التكلفة النهائية وتحديث تكلفة المخزون/COGS وقيود التسوية.',
            ],
          },
          {
            title: 'إنشاء طلب شراء',
            bullets: [
              'اختر المورد من القائمة.',
              'أضف الأصناف وحدد الكمية وسعر الشراء للوحدة في أمر الشراء.',
              'النظام يحسب الإجمالي تلقائيًا.',
              'تظهر توصيات إعادة الطلب للأصناف منخفضة المخزون مع اقتراح كميات وفق الوحدة.',
              'إذا كانت هناك تكاليف إضافية ثابتة للصنف (نقل/ضريبة مورد): اضبطها من إدارة الأصناف قبل أول استلام؛ تدخل تلقائيًا في متوسط التكلفة.',
            ],
          },
          {
            title: 'دفع المورد',
            bullets: [
              'يمكن تسجيل دفعة كاملة أو جزئية على أمر الشراء مع اختيار طريقة الدفع وتاريخ العملية.',
              'الدفعات لا تزيد المخزون؛ الذي يزيد المخزون هو الاستلام.',
              'يفيد تسجيل الدفعات في تتبع المديونية للمورد والتقارير المالية.',
            ],
          },
          {
            title: 'استلام البضاعة',
            bullets: [
              'عند استلام الطلب، يتغير المخزون تلقائيًا (زيادة الكمية).',
              'يتم تحديث متوسط "سعر التكلفة" تلقائيًا ويؤثر في تكلفة الصنف وتقارير الربحية.',
              'يمكن تسجيل استلام جزئي لكل صنف مع احترام خطوة الوحدة (وزني: 0.5، قطعي: 1).',
              'يمكن إدخال تاريخ الإنتاج والانتهاء لكل صنف أثناء الاستلام (اختياري) لتحديث بيانات الصنف.',
              'الاستلام ينشئ حركة مخزون ويُرحّل أثرها للنظام المحاسبي تلقائيًا (مخزون مقابل ذمم موردين).',
              'لا يمكن تعديل الطلب بعد الاستلام لضمان دقة المخزون.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'المورد، الأصناف، الكميات، أسعار الشراء.',
              'حفظ/تعديل/إلغاء.',
              'تسجيل دفعة: طريقة الدفع/التاريخ/المبلغ.',
              'استلام: إدخال الكمية الفعلية وتواريخ الإنتاج/الانتهاء إن لزم.',
            ],
          },
        ],
      },

      '/admin/accounting': {
        title: 'النظام المحاسبي (المحرك الخفي)',
        intro: 'كيف يقوم النظام بتسجيل القيود آلياً، حساب الأرباح، وضبط الميزانية (شرح للمالك والمبرمج).',
        sections: [
          {
            title: 'المبدأ: القيد المزدوج (Double Entry)',
            bullets: [
              'لكل عملية مالية طرفان: مدين (Debit) ودائن (Credit) يجب أن يتساويا.',
              'لا يسجل النظام "رقم واحد" بل يسجل "من أين جاء المال؟" و "أين ذهب؟".',
              'مثال البيع: يزيد الكاش (مدين) وتزيد المبيعات (دائن) + تزيد التكلفة (مدين) وينقص المخزون (دائن).',
            ],
          },
          {
            title: 'التقارير المالية الثلاثة',
            bullets: [
              '1. قائمة الدخل (P&L): تعرض ربحك (الإيرادات - التكاليف - المصاريف).',
              '2. الميزانية العمومية (Balance Sheet): تعرض موقفك المالي (ما تملكه من أصول vs ما عليك من ديون).',
              '3. التدفقات النقدية (Cash Flow): حركة الكاش فقط (تشغيلي، استثماري، تمويلي).',
            ],
          },
          {
            title: 'دورة المخزون والتكلفة',
            bullets: [
              'عند الشراء: تزيد قيمة أصل "المخزون" (Inventory Asset).',
              'عند البيع: تتحول قيمة البضاعة من "أصل" إلى "مصروف" يسمى (تكلفة البضاعة المباعة COGS).',
              'الربح الحقيقي = سعر البيع - (متوسط تكلفة الصنف وقت البيع).',
            ],
          },
          {
            title: 'حسابات الترحيل الآلي vs بقية الحسابات',
            bullets: [
              'حسابات الترحيل الآلي (Control Accounts) تُعرّف في إعدادات التطبيق تحت accounting_accounts وتُستخدم حصريًا في دوال الترحيل الآلي: post_inventory_movement، post_order_delivery، post_payment.',
              'هذه الحسابات تمثل نقاط الربط الأساسية (Inventory, COGS, AR, AP, Cash, Bank, Deposits, VAT…). تُحمّل ديناميكيًا مع قيم افتراضية سليمة ولا تُستخدم أي حسابات غير مُعرّفة أو عشوائية.',
              'بقية شجرة الحسابات (Operational/Analytical) في chart_of_accounts تُستخدم بحرية للقيود اليدوية والمصاريف والإيرادات والتسويات دون الحاجة لإضافتها في accounting_accounts.',
              'إضافة حساب جديد (مصروف/إيراد/تحليلي) لا تتطلب أي تعديل على إعدادات الترحيل الآلي.',
              'إعدادات accounting_accounts ليست تمثيلًا كاملًا للدليل، بل حسابات التحكم في الترحيل فقط.',
              'أي قيد آلي يفشل صراحةً إذا كان الحساب المعيّن غير موجود في الدليل؛ لا يتم الترحيل إلى حساب بديل صامت.',
            ],
          },
          {
            title: 'نصائح للمالك',
            bullets: [
              'لا تتلاعب بالمخزون يدوياً دون سبب، لأن ذلك يخل بالميزانية.',
              'استخدم "أوامر الشراء" دائماً لضبط متوسط التكلفة بدقة.',
              'راجع تقرير الأرباح والخسائر شهرياً لتعرف صافي دخلك الحقيقي.',
            ],
          },
        ],
      },
      '/admin/shift-reports': {
        title: 'تقارير الورديات',
        intro: 'شرح مبسّط لضبط الصندوق يومياً عبر نظام الوردية، مع أدوار الكاشير والمدير وطريقة الحساب.',
        sections: [
          {
            title: 'الاستخدام اليومي',
            bullets: [
              'بدء الوردية: الكاشير يُدخل عهدة البداية (المبلغ في الصندوق قبل البيع).',
              'أثناء الوردية: تتم المبيعات ويحسب النظام نقداً متوقعاً تلقائياً.',
              'إنهاء الوردية: الكاشير يجرد الصندوق ويُدخل النقد الفعلي ثم يؤكد الإغلاق.',
              'إذا ظهرت رسالة خطأ عند الإغلاق: صحّح المبلغ المدخل أو أعد المحاولة.',
            ],
          },
          {
            title: 'دور الكاشير',
            bullets: [
              'زر الوردية يظهر أسفل القائمة الجانبية داخل لوحة الإدارة.',
              'لا يمكن للكاشير فتح أكثر من وردية في نفس الوقت.',
              'يرى الكاشير “النقد المتوقع” قبل الإغلاق ليساعده على الجرد الصحيح.',
            ],
          },
          {
            title: 'دور المدير/المالك',
            bullets: [
              'صفحة تقارير الورديات تعرض فتح/إغلاق وعهدة البداية والمتوقع والفعلي والفرق.',
              'يمكن للمدير/المالك إغلاق وردية مفتوحة إذا نسي الكاشير الإغلاق.',
              'يوصى بالمراجعة اليومية للفرق لمعالجة أسباب العجز/الفائض بسرعة.',
            ],
          },
          {
            title: 'طريقة الحساب',
            bullets: [
              'النقد المتوقع = عهدة البداية + المدفوعات النقدية الداخلة − المدفوعات النقدية الخارجة.',
              'المدفوعات غير النقدية (حسابات بنكية/حوالات) لا تُحتسب ضمن النقد المتوقع لأنها لا تدخل الصندوق نقداً.',
              'الفرق = الفعلي بعد الجرد − المتوقع: موجب = فائض، سالب = عجز.',
            ],
          },
          {
            title: 'نصائح وحالات شائعة',
            bullets: [
              'نسيان الإغلاق: أغلقها من تقارير الورديات ثم عالج السبب إن وجد.',
              'وجود عجز: راجع المدفوعات النقدية غير المسجلة أو صرف غير موثّق.',
              'وجود فائض: قد تكون هناك دفعة نقدية سُجّلت بطريقة غير نقدية أو زيادة غير محسوبة.',
              'عند تعدد الكاشير: النظام يمنع وردية ثانية للكاشير نفسه؛ افتح لكل كاشير ورديته الخاصة.',
            ],
          },
        ],
      },
      '/admin/shift-reports/:shiftId': {
        title: 'تفاصيل الوردية',
        intro: 'عرض بيانات وردية محددة وربط المدفوعات والتحصيل والملاحظات.',
        sections: [
          {
            title: 'المحتوى',
            bullets: [
              'عهدة البداية، النقد المتوقع، النقد الفعلي، والفرق.',
              'قائمة المدفوعات المرتبطة خلال الوردية.',
              'ملاحظات الكاشير وأحداث الإغلاق.',
            ],
          },
          {
            title: 'الإدارة',
            bullets: [
              'إغلاق وردية مفتوحة عند الحاجة مع تبرير.',
              'مراجعة الفروقات واتخاذ إجراءات تصحيحية.',
            ],
          },
        ],
      },
      '/admin/stock': {
        title: 'إدارة المخزون',
        intro: 'عرض المخزون وتحديث الكميات ومعرفة التنبيهات والأرشفة التلقائية.',
        sections: [
          {
            title: 'الهدف',
            bullets: [
              'تحديث المتاح والمحجوز حسب حركة الطلبات.',
              'متابعة الأصناف منخفضة المخزون.',
              'ضبط حد التنبيه يساعدك على معرفة الأصناف التي تحتاج توريد سريع.',
            ],
          },
          {
            title: 'كيف نضمن دقة الأرقام؟',
            bullets: [
              'الخصم الذري (Atomic Deduction): يمنع بيع نفس القطعة لزبونين في نفس اللحظة.',
              'المتوسط المرجح (Weighted Average): يعيد النظام حساب تكلفة القطعة الواحدة بعد كل عملية شراء جديدة.',
              'المتاح = الكمية الكلية - الكمية المحجوزة في طلبات لم تسلم بعد.',
            ],
          },
          {
            title: 'متى أعدل المخزون يدويًا؟',
            bullets: [
              'عند الجرد/التسوية أو تصحيح فرق فعلي، مع كتابة سبب التعديل.',
              'عند التلف/الهدر استخدم تسجيل الهدر إن كان متاحًا بدل تعديل رقم بدون سبب.',
              'الاستلام من المشتريات هو المسار الأساسي لزيادة المخزون.',
            ],
          },
          {
            title: 'الأرشفة التلقائية (Auto-Expiry)',
            bullets: [
              'يقوم النظام يومياً بفحص تواريخ انتهاء الصلاحية.',
              'المنتجات المنتهية تُنقل تلقائياً إلى "الهدر" ويصبح مخزونها صفر.',
              'يظهر إشعار للمدير عند حدوث أرشفة تلقائية.',
            ],
          },
        ],
      },
      '/admin/prices': {
        title: 'إدارة الأسعار',
        intro: 'تعديل السعر الأساسي للصنف وتسجيل سبب التغيير مع عرض تاريخ الأسعار.',
        sections: [
          {
            title: 'الاستخدام',
            bullets: [
              'اختر الصنف ثم أدخل السعر الجديد والسبب ثم احفظ.',
              'يُسجل النظام العملية في سجل الأسعار (Price History) لتتبع من غيّر السعر ومتى ولماذا.',
              'السعر الأساسي يُستخدم كمرجع افتراضي عند عدم وجود سعر خاص أو شريحة سارية.',
              'إذا كانت لديك شرائح أسعار أو أسعار خاصة، فقد يظهر للعميل سعر مختلف عن السعر الأساسي حسب القواعد.',
            ],
          },
          {
            title: 'ملاحظات مهمة',
            bullets: [
              'السعر النهائي وقت البيع قد يعتمد على نوع العميل والكمية (شرائح) أو سعر خاص للعميل.',
              'للأصناف بالوزن: انتبه لوحدة التسعير (كجم/جرام) في شاشة البيع.',
            ],
          },
        ],
      },
      '/admin/price-tiers': {
        title: 'شرائح الأسعار',
        intro: 'إدارة أسعار خاصة حسب نوع العميل والكمية مع فترات صلاحية.',
        sections: [
          {
            title: 'ما هي الشرائح؟',
            bullets: [
              'تجزئة/جملة/موزع/VIP لكل صنف.',
              'سعر مخصص يبدأ من كمية معينة وحتى حد أقصى أو غير محدود.',
              'يمكن إضافة نسبة خصم إضافية لإبراز العرض.',
            ],
          },
          {
            title: 'الإدارة',
            bullets: [
              'فلترة حسب الصنف أو نوع العميل.',
              'إضافة/تعديل/حذف شريحة مع تحديد فترة الصلاحية.',
              'تفعيل/تعطيل الشريحة للتحكم بسرعة في تطبيقها.',
            ],
          },
          {
            title: 'أثرها على التسعير',
            bullets: [
              'الأولوية عادةً: سعر خاص للعميل ← ثم شريحة أسعار سارية ← ثم السعر الأساسي.',
              'للأصناف بالوزن: اجعل حد الكمية الأدنى مناسبًا (قد يبدأ من 0 للوزني).',
              'للأصناف بالعدد: عادةً يبدأ حد الكمية من 1.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'نوع العميل، نطاق الكمية، السعر/نسبة الخصم.',
              'فترة الصلاحية والتفعيل/التعطيل.',
              'حفظ/تعديل/حذف.',
            ],
          },
        ],
      },
      '/pos': {
        title: 'نقطة البيع (POS)',
        intro: 'بيع حضوري سريع مع دعم طرق الدفع، الخصومات، وطباعة الفاتورة.',
        sections: [
          {
            title: 'العملة (Transaction Currency)',
            bullets: [
              'اختر عملة المعاملة من القائمة أعلى الشاشة قبل البدء.',
              'كل الأسعار والإجماليات والدفعات والباقي تُدخل وتُعرض بعملة المعاملة.',
              'الفواتير المعلّقة تُحفظ بعملتها؛ عند فتح فاتورة معلّقة راجع العملة قبل الإتمام.',
              'أفضل ممارسة: لا تغيّر عملة المعاملة بعد إدخال أصناف/دفعات؛ ابدأ فاتورة جديدة بعملة صحيحة لتجنب عدم تطابق المبالغ.',
            ],
          },
          {
            title: 'البيع السريع',
            bullets: [
              'ابحث عن الأصناف وأضفها للسلة مع الإضافات.',
              'اضبط الخصم؛ قد يحتاج موافقة إذا تجاوز حد الصلاحية.',
              'اختر طريقة الدفع وسجّل العملية.',
              'الدفع النقدي يتطلب فتح وردية نقدية قبل السداد.',
            ],
          },
          {
            title: 'الفاتورة والمخزون',
            bullets: [
              'تصدر الفاتورة مباشرة عند التسليم والدفع.',
              'تُخصم الكميات فوراً بشكل ذري لضمان دقة المخزون.',
            ],
          },
          {
            title: 'الباركود (إضافة تلقائية)',
            bullets: [
              'فعّل من الإعدادات: إعدادات POS › تمكين إضافة عبر الباركود.',
              'ضع المؤشر في حقل البحث في شاشة POS.',
              'امسح الباركود؛ إذا كان الماسح يرسل Enter بعد المسح فستُضاف السلعة تلقائياً إذا تطابق barcode أو sku.',
              'للأصناف بالوزن: استخدم قيمة “الوزن” بجانب البحث قبل المسح.',
              'نصائح: اضبط الماسح على إرسال Enter وتجنّب مسافات/رموز غير رقمية في الأكواد.',
            ],
          },
          {
            title: 'الطباعة الحرارية التلقائية',
            bullets: [
              'فعّل من الإعدادات: إعدادات POS › الطباعة الحرارية التلقائية بعد الإتمام وحدد عدد النسخ.',
              'بعد الإتمام تُفتح الفاتورة بنمط حراري وتبدأ الطباعة تلقائيًا.',
              'سطح المكتب: الطباعة عبر المتصفح إلى الطابعة الحرارية (عرض 58mm).',
              'الأجهزة المحمولة (Capacitor): يتم إنشاء PDF للمشاركة؛ اختر “طباعة” من قائمة المشاركة.',
              '“نسخة” تُضاف تلقائيًا عند إعادة الطباعة وتُحدّث عداد الطباعة.',
            ],
          },
          {
            title: 'إدخال الكمية/الوزن بلوحة رقمية',
            bullets: [
              'للوزن: اضغط زر “لوحة” بجانب حقل الوزن وأدخل القيمة (يدعم الأرقام العشرية).',
              'للعدد: اضغط زر “لوحة” بجانب +/– وأدخل الكمية (أعداد صحيحة).',
              'استخدم زر “تقريب” لتثبيت القيمة كعدد صحيح عند الحاجة.',
            ],
          },
          {
            title: 'مؤشرات المخزون',
            bullets: [
              '“متاح”: الكمية المتوفرة في المخزون.',
              '“محجوز”: الكمية المحجوزة في الطلبات المعلّقة.',
              'عند ظهور “نفدت الكمية” يجب تعديل الكمية أو التوريد قبل الإتمام.',
            ],
          },
          {
            title: 'استكشاف الأخطاء',
            bullets: [
              'لا تتم إضافة بالباركود: تأكد من وجود barcode/sku وأن الماسح يرسل Enter وأن البحث في حالة تركيز.',
              'لا تتم الطباعة تلقائيًا: تأكد من تفعيل الإعداد وتعريف الطابعة الحرارية، وعلى المحمول استخدم مشاركة PDF ثم الطباعة.',
              'رفض الدفع النقدي: افتح وردية نقدية من شاشة الوردية قبل السداد.',
            ],
          },
        ],
      },
      '/admin/reports/financial': {
        title: 'التقارير المالية',
        intro: 'قراءة قائمة الدخل والميزانية والتدفقات النقدية مع فلاتر دقيقة.',
        sections: [
          {
            title: 'المحتوى',
            bullets: [
              'قائمة الدخل (P&L): الإيرادات، المصروفات، صافي الربح للفترة المختارة.',
              'الميزانية العمومية (Balance Sheet): موقف الأصول والخصوم وحقوق الملكية في تاريخ معين.',
              'التدفقات النقدية (Cash Flow): تشغيلي/استثماري/تمويلي وتحليل حركة النقد فقط.',
            ],
          },
          {
            title: 'العملة في التقارير',
            bullets: [
              'التقارير المالية تُعرض بالعملة الأساسية (عملة الدفاتر) لضمان المقارنة عبر الفترات.',
              'المعاملات قد تُسجل بعملات تشغيلية متعددة، ويقوم النظام بتجميعها وعرض نتائجها بالعملة الأساسية في التقارير.',
            ],
          },
          {
            title: 'الفلاتر والنطاقات',
            bullets: [
              'اختر فترة أو نطاق تاريخي؛ الفترات المغلقة تُعرض للقراءة مع منع التعديل.',
              'تصفية حسب مركز تكلفة لتحليل ربحيّة الأقسام.',
            ],
          },
          {
            title: 'الأمان والدقة',
            bullets: [
              'نموذج القيد المزدوج يضمن توازن القيود وعدم فقدان بيانات.',
              'RLS يمنع الوصول لبيانات غير مصرح بها حسب الدور.',
            ],
          },
          {
            title: 'التصدير',
            bullets: [
              'مشاركة PDF أو تصدير CSV عند توفر الصلاحيات.',
              'استخدم التقارير لمراجعة شهرية واتخاذ قرارات تشغيلية.',
            ],
          },
          {
            title: 'إقفال الفترات المحاسبية',
            bullets: [
              'ما قبل الإقفال: راجع القيود والمدفوعات والمرتجعات والضرائب حتى نهاية الشهر.',
              'خطوات الإقفال: من صفحة المحاسبة (عند توفرها) أو عبر إجراء إداري، اضبط تاريخ نهاية الفترة واضغط إقفال؛ يتطلب صلاحية "إقفال الفترات المحاسبية".',
              'الأثر: يمنع تعديل القيود قبل تاريخ الإقفال ويُظهر علامة قفل على التقارير لتلك الفترة.',
              'العكس/الفتح: يحتاج صلاحية اعتماد/عكس القيود؛ لا يُنصح إلا للضرورة مع توثيق السبب.',
              'نصيحة: أقفل شهريًا بعد مطابقة VAT والدفع والبنك لضمان دقة القوائم.',
            ],
          },
        ],
      },
      '/admin/approvals': {
        title: 'طلبات الموافقة',
        intro: 'إدارة طلبات الموافقة مثل خصومات POS التي تتجاوز الصلاحيات.',
        sections: [
          {
            title: 'المراجعة',
            bullets: [
              'يعرض الطلبات المعلقة مع تفاصيل المبلغ والسبب.',
              'يمكن قبول أو رفض الطلب مع تعليق اختياري.',
            ],
          },
          {
            title: 'الأثر',
            bullets: [
              'عند الموافقة يُطبّق الخصم على الطلب المرتبط.',
              'عند الرفض يُلغى الخصم ويُبلّغ صاحب الطلب.',
            ],
          },
        ],
      },
      '/admin/database': {
        title: 'مستكشف قاعدة البيانات',
        intro: 'عرض جداول رئيسية مثل الحركات والقيود والمصاريف والسجلات للمراجعة السريعة.',
        sections: [
          {
            title: 'الجداول الشائعة',
            bullets: [
              'حركات المخزون، سجلات الأسعار، المدفوعات.',
              'قيود اليومية وخطة الحسابات والفترات المحاسبية.',
              'مرتجعات المبيعات وتالف المخزون.',
            ],
          },
          {
            title: 'الاستخدام الآمن',
            bullets: [
              'العرض فقط للمراجعة ضمن الصلاحيات.',
              'لا تقم بتعديلات مباشرة إلا عبر شاشات الأعمال المخصصة.',
            ],
          },
        ],
      },
      '/admin/wastage': {
        title: 'تسجيل الهدر',
        intro: 'تسجيل تالف المخزون مع أثر محاسبي وضبط الكميات.',
        sections: [
          {
            title: 'التسجيل',
            bullets: [
              'اختر الصنف وحدد الكمية المتلفة والملاحظات.',
              'يحسم من المخزون ويُسجل كمصروف هدر.',
            ],
          },
          {
            title: 'التقارير',
            bullets: [
              'راجع تقارير الهدر لمعرفة الأسباب واتخاذ إجراءات تصحيحية.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'الصنف، الكمية، سبب/ملاحظات.',
              'تنفيذ: إنشاء قيد الهدر وضبط المخزون.',
            ],
          },
        ],
      },
      '/admin/expiry-batches': {
        title: 'دفعات منتهية',
        intro: 'مراجعة الدفعات المنتهية صلاحيتها والأرشفة التلقائية.',
        sections: [
          {
            title: 'المراجعة',
            bullets: [
              'يعرض الدفعات المنتهية مع التاريخ والكمية.',
              'انقل للهدر إن لم تُباع وفق السياسة.',
            ],
          },
        ],
      },
      '/admin/wastage-expiry-reports': {
        title: 'تقارير الهدر/الانتهاء',
        intro: 'تحليل مخاطر الهدر وانتهاء الصلاحية لاتخاذ قرارات توريد أفضل.',
        sections: [
          {
            title: 'المحتوى',
            bullets: [
              'ملخص الكميات المتلفة حسب الفترة والصنف.',
              'تحديد الأصناف ذات المخاطر العالية لتحسين الطلب.',
            ],
          },
        ],
      },
      '/admin/warehouses': {
        title: 'المستودعات',
        intro: 'إدارة مستودعات متعددة لتوزيع المخزون وتتبع الحركات.',
        sections: [
          {
            title: 'الإدارة',
            bullets: [
              'إنشاء مستودع وتحديد اسمه وموقعه.',
              'تفعيل/تعطيل المستودع حسب الحاجة.',
            ],
          },
        ],
      },
      '/admin/import-shipments': {
        title: 'الشحنات',
        intro: 'إدارة الشحنات وتجميع تكاليفها وربطها بالاستلامات لتثبيت التكلفة النهائية بدقة (Landed Cost).',
        sections: [
          {
            title: 'الفرق بين الشحنة وأمر الشراء',
            bullets: [
              'أمر الشراء: وثيقة “اتفاق شراء” مع مورد واحد لتحديد الكميات والأسعار والمتابعة والاستلام.',
              'الشحنة: وعاء “تجميع تكاليف” وربط الاستلامات ثم تثبيت التكلفة النهائية بعد إضافة المصاريف الإضافية.',
              'القاعدة: استخدم PO للشراء من المورد، واستخدم الشحنة عندما تريد تكلفة هبوط (Landed Cost) واقعية.',
            ],
          },
          {
            title: 'العملات وتكاليف الهبوط (Landed Cost)',
            bullets: [
              'أي بند تكلفة في الشحنة يجب أن يرتبط بعملة صريحة (صنف أو مصروف).',
              'أدخل أسعار الشراء للأصناف بعملة الشراء، وأدخل مصاريف الشحنة بعملتها مع سعر الصرف المستخدم عند التسجيل.',
              'إذا ظهرت عملة غير موجودة: ارجع للإعدادات وأضفها في جدول العملات قبل المتابعة.',
              'بعد الإقفال تُستخدم هذه البيانات لتثبيت التكلفة النهائية على المخزون/الدفعات وفق قواعد النظام.',
            ],
          },
          {
            title: 'متى تستخدم الشحنات؟',
            bullets: [
              'عند وجود تكاليف إضافية يجب تحميلها على الأصناف (نقل، تخليص، تفريغ، رسوم...).',
              'للشحنات المستوردة أو التوريد المحلي متعدد التكاليف/الدافعين.',
              'عندما تريد تسوية محاسبية صحيحة للتكاليف عبر حساب تسوية (مثل 2060) ثم تحميلها على المخزون/COGS.',
            ],
          },
          {
            title: 'هل الشحنة تقبل أكثر من مورد؟',
            bullets: [
              'نعم، عمليًا يمكن ربط أكثر من استلام (Receipt) في نفس الشحنة، وكل استلام مرتبط بأمر شراء لمورد واحد.',
              'حقل المورد في الشحنة اختياري ويُستخدم فقط إذا كانت الشحنة لمورد واحد أو لغرض تصنيفي؛ الشحنة نفسها يمكن أن تكون “مجمعة”.',
              'أفضل ممارسة: إذا كانت مصاريف الشحنة مشتركة بين موردين، يمكنك إبقاؤها شحنة واحدة وربط الاستلامات؛ وإذا أردت تحليل أدق لكل مورد، افصلها إلى شحنات متعددة.',
            ],
          },
          {
            title: 'الدورة المختصرة',
            bullets: [
              'أنشئ الشحنة وحدد المستودع الوجهة.',
              'أضف الأصناف والكميات وسعر الشراء.',
              'أضف مصاريف الشحنة مع العملة وسعر الصرف إن لزم.',
              'اربط الاستلامات (Purchase Receipts) بالشحنة قبل الإقفال.',
              'احتسب التكلفة ثم أغلق الشحنة لتثبيت التكلفة وتحديث المخزون وقيود التسوية.',
            ],
          },
        ],
      },
      '/admin/import-shipments/:id': {
        title: 'تفاصيل الشحنة',
        intro: 'إدارة أصناف الشحنة ومصاريفها وربط الاستلامات، ثم احتساب التكلفة وإقفال الشحنة والتسعير منها.',
        sections: [
          {
            title: 'الطريقة الصحيحة بالتفصيل',
            bullets: [
              '1) أنشئ أوامر شراء (PO) لكل مورد ثم نفّذ الاستلامات (Receipts) في المستودع الوجهة.',
              '2) في تبويب الاستلامات: اربط الاستلامات بالشحنة (يمكن ربط عدة استلامات).',
              '3) في تبويب المصاريف: أدخل مصاريف الشحنة (المبلغ/العملة/سعر الصرف/الوصف) مع تواريخ السداد عند الحاجة.',
              '4) اضغط “احتساب التكلفة” ثم راجع توزيع التكلفة على الأصناف.',
              '5) اضغط “إغلاق الشحنة” لتثبيت التكلفة النهائية وتحديث المخزون/الدفعات والقيود المحاسبية.',
            ],
          },
          {
            title: 'إدخال المصاريف بعملة أجنبية',
            bullets: [
              'أدخل المبلغ بعملة المصروف، ثم اختر العملة من القائمة.',
              'أدخل سعر الصرف المستخدم (المبلغ بالعملة × سعر الصرف = ما يعادله بالعملة الأساسية).',
              'تأكد أن العملة موجودة ضمن العملات المعرفة في الإعدادات قبل الحفظ.',
              'راجِع توزيع التكلفة بعد الاحتساب، ثم أغلق الشحنة لتثبيت النتائج.',
            ],
          },
          {
            title: 'التبويبات',
            bullets: [
              'الأصناف: إضافة/حذف أصناف الشحنة (الكميات وسعر الشراء).',
              'المصاريف: إضافة مصاريف الشحنة (نوع المصروف/المبلغ/العملة/سعر الصرف).',
              'الاستلامات: ربط/فصل استلامات الشراء بالشحنة قبل الإقفال.',
              'التسعير: عرض التكلفة النهائية واقتراح سعر بيع واعتماد السعر للصنف أو للشريحة.',
            ],
          },
          {
            title: 'خطوات العمل الموصى بها',
            bullets: [
              'اربط الاستلامات الصحيحة بالشحنة أولاً من تبويب الاستلامات.',
              'اضغط “احتساب التكلفة” لتوزيع المصاريف على الأصناف.',
              'اضغط “إغلاق الشحنة” لتثبيت التكلفة وتحديث المخزون والدفعات وقيود التسوية.',
            ],
          },
          {
            title: 'قيود مهمة',
            bullets: [
              'لا يمكن تعديل ربط الاستلامات بعد إغلاق الشحنة.',
              'إذا كانت الاستلامات غير مرتبطة أو الكميات غير متطابقة، قد تفشل عملية الإغلاق للحماية من توزيع خاطئ.',
            ],
          },
          {
            title: 'تعدد الموردين داخل شحنة واحدة',
            bullets: [
              'يمكنك ربط استلامات متعددة من أوامر شراء مختلفة داخل نفس الشحنة.',
              'استخدم هذا فقط عندما تمثل الشحنة توريدًا واحدًا بمصاريف مشتركة (مثلاً: حاوية تضم عدة فواتير).',
              'إذا كانت المصاريف تخص موردًا بعينه، الأفضل فصلها إلى شحنة مستقلة حتى لا تختلط التكلفة.',
            ],
          },
          {
            title: 'التسعير من التكلفة',
            bullets: [
              'يعرض النظام التكلفة/وحدة والسعر الحالي ونسبة هامش ربح لإنتاج سعر مقترح.',
              'زر “اعتماد للصنف” يحدّث السعر الأساسي للصنف مع تسجيل سبب التغيير.',
              'زر “اعتماد للشريحة” يحدّث شريحة السعر المختارة (جملة/تجزئة/موزع/VIP) للصنف.',
              'زر “حد أدنى للدفعات” يضبط حد البيع الأدنى للدفعات المرتبطة لمنع البيع تحت الحد.',
            ],
          },
        ],
      },
      '/admin/warehouse-transfers': {
        title: 'تحويلات المستودعات',
        intro: 'نقل كميات بين المستودعات مع حركات مخزون دقيقة.',
        sections: [
          {
            title: 'التحويل',
            bullets: [
              'اختر المستودع المصدر والوجهة والأصناف والكميات.',
              'ينشئ النظام حركتين: إخراج من المصدر وإدخال في الوجهة.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'المصدر والوجهة: تحديد المستودعين.',
              'قائمة الأصناف والكميات: تحديد العناصر المحولة.',
              'تنفيذ التحويل: إنشاء الحركات وضبط المخزون.',
            ],
          },
        ],
      },
      '/admin/cost-centers': {
        title: 'مراكز التكلفة',
        intro: 'تصنيف المصروفات حسب المراكز لقراءة أدق للأداء المالي.',
        sections: [
          {
            title: 'الإدارة',
            bullets: [
              'إنشاء مركز تكلفة وربطه بالمصاريف أو العمليات.',
              'عرض تقارير نقدية حسب مركز التكلفة.',
            ],
          },
        ],
      },
      '/admin/my-shift': {
        title: 'ورديتي',
        intro: 'شاشة الكاشير لإدارة عهدة البداية والجرد وإغلاق الوردية.',
        sections: [
          {
            title: 'الفتح والإغلاق',
            bullets: [
              'أدخل عهدة البداية ثم ابدأ الوردية.',
              'عند الإغلاق أدخل النقد الفعلي لمقارنة الفرق.',
            ],
          },
          {
            title: 'الملاحظات',
            bullets: [
              'لا يمكن فتح وردية ثانية لنفس الكاشير.',
              'المبالغ غير نقدية لا تدخل ضمن النقد المتوقع.',
            ],
          },
        ],
      },
      '/admin/profile': {
        title: 'ملف الإدارة',
        intro: 'تحديث بيانات المدير، تغيير كلمة المرور، وإدارة مستخدمي لوحة التحكم حسب الصلاحيات.',
        sections: [
          {
            title: 'المعلومات الشخصية',
            bullets: [
              'يمكن تعديل: الاسم، اسم المستخدم، البريد، رقم الهاتف، والصورة.',
              'زر حفظ التغييرات يحدّث بيانات الملف الشخصي.',
              'إن غيّرت البريد قد تتطلب العملية تأكيدًا حسب مزود الدخول.',
            ],
          },
          {
            title: 'كلمة المرور',
            bullets: [
              'يتطلب إدخال كلمة المرور الحالية ثم الجديدة وتأكيدها.',
              'يجب أن تكون كلمة المرور الجديدة 6 أحرف على الأقل.',
              'اختر كلمة مرور قوية: أحرف كبيرة/صغيرة + أرقام + رمز.',
            ],
          },
          {
            title: 'مستخدمو لوحة التحكم',
            bullets: [
              'قد تظهر إدارة المستخدمين فقط عند توفر صلاحية إدارة مستخدمي لوحة التحكم.',
              'يمكن إنشاء مستخدم جديد وتحديد دوره وتخصيص صلاحياته.',
              'يمكن تعديل المستخدمين وإعادة تعيين كلمة المرور وتفعيل/تعطيل الحساب وحذفه.',
              'تأكد من إعطاء أقل صلاحيات ممكنة لكل موظف.',
            ],
          },
        ],
      },
      '/admin/invoice/:orderId': {
        title: 'فاتورة الإدارة',
        intro: 'عرض وطباعة فاتورة طلب داخل مسار الإدارة.',
        sections: [
          {
            title: 'العرض والطباعة',
            bullets: [
              'يعرض تفاصيل الطلب والإجمالي والضريبة عند التفعيل.',
              'زر مشاركة PDF أو الطباعة وفق الإعدادات.',
            ],
          },
          {
            title: 'السياسات',
            bullets: [
              'إصدار الفاتورة عادةً بعد التسليم والتحصيل.',
              'إعادة الطباعة قد تُوسم كنسخة إضافية.',
            ],
          },
        ],
      },
      '/admin/cod-settlements': {
        title: 'تسوية COD',
        intro: 'تجميع وتسوية طلبات الدفع عند التسليم حسب المندوب داخل وردية الكاشير.',
        sections: [
          {
            title: 'المتطلبات',
            bullets: [
              'لا بد من وردية نقدية مفتوحة للكاشير.',
              'صلاحية مطلوبة: accounting.manage.',
            ],
          },
          {
            title: 'التجميع والتسوية',
            bullets: [
              'تجميع تلقائي حسب المندوب مع إجمالي المتبقي.',
              'تسوية جماعية عبر Modal تأكيد (اسم، عدد الطلبات، الإجمالي).',
            ],
          },
          {
            title: 'التدقيق والقراءة فقط',
            bullets: [
              'شارة "نقد لدى المندوب" تُعرض للقراءة من v_driver_ledger_balances.',
              'زر "عرض سجل COD" يعرض نتيجة get_cod_audit كـ JSON للقراءة فقط.',
            ],
          },
          {
            title: 'الأمان',
            bullets: [
              'الجداول المحاسبية (ledger_entries/ledger_lines/driver_ledger/cod_settlements/cod_settlement_orders) مفعّل عليها FORCE ROW LEVEL SECURITY.',
              'لا يمكن تجاوز سياسات RLS حتى بالأدوار العليا أو الاستدعاءات غير المتوقعة.',
            ],
          },
          {
            title: 'سلامة البيانات',
            bullets: [
              'غير COD: لن يُضبط paidAt إلا بعد تسجيل الدفعة بنجاح؛ في وضع Offline فقط يُسمح بضبطه مع جدولة الدفع.',
            ],
          },
        ],
      },
      '/admin/settings': {
        title: 'الإعدادات العامة',
        intro: 'ضبط بيانات المتجر والهوية البصرية والولاء والتوصيل وطرق الدفع.',
        sections: [
          {
            title: 'بيانات المتجر',
            bullets: [
              'اسم المتجر.',
              'رفع الشعار (ملف صورة) أو إزالته.',
              'رقم التواصل والعنوان.',
              'هذه البيانات تظهر للعميل في أجزاء متعددة من التطبيق.',
            ],
          },
          {
            title: 'إعدادات العملات المتعددة',
            bullets: [
              'حدد العملة الأساسية للنظام ثم اضغط “حفظ العملة الأساسية” لتطبيقها على الدفاتر والتقارير المحاسبية.',
              'أضف العملات التشغيلية التي ستتعامل بها (اكتب رمز العملة واضغط Enter).',
              'راجع جدول العملات (currencies): يوضح العملات المُعرفة، وتستطيع تمييز عملة “تضخم مرتفع” عند الحاجة.',
              'افتح شاشة “أسعار الصرف” لإدخال أسعار العملات مقابل العملة الأساسية حسب التاريخ ونوع السعر.',
              'قاعدة عامة: أي مبلغ يُعرض أو يُسجل يجب أن يكون مرتبطًا بعملة صريحة؛ لا تعتمد على عملة ضمنية.',
            ],
          },
          {
            title: 'ألوان التطبيق',
            bullets: [
              'تعديل اللون الأساسي والذهبي والثانوي عبر منتقي الألوان.',
              'تظهر معاينة سريعة للألوان قبل الحفظ.',
              'يفضل اختيار ألوان متباينة لضمان وضوح النصوص.',
            ],
          },
          {
            title: 'الولاء والتوصيل والدفع',
            bullets: [
              'تفعيل/تعطيل برنامج الولاء وضبط نقاط الكسب وقيمة النقطة والمستويات.',
              'ضبط مكافآت الدعوة وخصم المستخدم الجديد.',
              'إعداد رسوم التوصيل الأساسية وحد التوصيل المجاني.',
              'تفعيل طرق الدفع المتاحة (عند الاستلام/حسابات بنكية/حوالات).',
              'عند إيقاف طريقة دفع لن تظهر للعميل في صفحة الإتمام.',
            ],
          },
          {
            title: 'إعدادات الضريبة (VAT)',
            bullets: [
              'تفعيل/تعطيل ضريبة القيمة المضافة.',
              'تحديد نسبة الضريبة (مثلاً 15%).',
              'إدخال الرقم الضريبي للمنشأة ليظهر في الفواتير.',
              'عند التفعيل، يتم احتساب الضريبة تلقائياً وفصلها في التقارير.',
            ],
          },
          {
            title: 'إعدادات التطبيق',
            bullets: [
              'زر "حفظ التغييرات" يطبق كل الإعدادات.',
              'بعد الحفظ قد تحتاج لتحديث صفحة الويب لرؤية كل التغييرات فورًا.',
            ],
          },
        ],
      },
      '/admin/fx-rates': {
        title: 'أسعار الصرف',
        intro: 'إدارة أسعار الصرف للعملات مقابل العملة الأساسية مع نوعين (تشغيلي/محاسبي) وسجل تدقيق للقراءة فقط.',
        sections: [
          {
            title: 'قبل البدء',
            bullets: [
              'تأكد من تحديد العملة الأساسية وتعريف العملات التشغيلية من الإعدادات.',
              'اختيار نوع السعر مهم: تشغيلي للاستخدام اليومي، ومحاسبي للسياسات المحاسبية/الفترات حسب سياسة منشأتك.',
            ],
          },
          {
            title: 'إضافة/تحديث سعر',
            bullets: [
              'اختر العملة.',
              'اختر نوع السعر (تشغيلي أو محاسبي).',
              'حدد تاريخ السعر.',
              'أدخل سعر الصرف كقيمة موجبة ثم اضغط “حفظ”.',
              'يمكن إضافة أكثر من سعر لنفس العملة بتواريخ مختلفة، ويستخدم النظام السعر حسب تاريخ العملية ونوعها.',
            ],
          },
          {
            title: 'سجل التدقيق (Audit Log)',
            bullets: [
              'أي إضافة/تعديل/حذف لسعر الصرف تُسجل في سجل الرقابة والتدقيق ضمن وحدة fx_rates.',
              'السجل للقراءة فقط ويهدف لتتبع من غيّر السعر ومتى ولماذا عند المراجعات.',
            ],
          },
          {
            title: 'تحذيرات',
            bullets: [
              'لا تعدّل أسعار صرف تاريخ سابق بدون سبب محاسبي واضح، خصوصًا بعد إقفال فترة.',
              'تأكد من إدخال السعر لنوعه الصحيح؛ اختلاف النوع قد يغيّر نتائج التقارير والسياسات التشغيلية.',
            ],
          },
        ],
      },
      '/admin/delivery-zones': {
        title: 'مناطق التوصيل',
        intro: 'إدارة مناطق التوصيل والرسوم والوقت المتوقع.',
        sections: [
          {
            title: 'الخريطة التفاعلية',
            bullets: [
              'اسحب العلامة على الخريطة لتحديد مركز المنطقة بدقة.',
              'تحكم في نصف القطر (Radius) لتغطية المنطقة المطلوبة.',
              'تعرض الخريطة دائرة نصف القطر لتوضيح التغطية الفعلية.',
            ],
          },
          {
            title: 'الإحصائيات',
            bullets: [
              'يعرض الجدول إحصائيات لكل منطقة: عدد الطلبات، الإيرادات، ومتوسط وقت التوصيل.',
              'زر "تحديث الإحصائيات" يقوم بإعادة الحساب بناءً على جميع الطلبات السابقة.',
              'يُحتسب الأداء الآن اعتمادًا على عمود منطقة التوصيل المخصص لسرعة ودقة أعلى.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'اسم المنطقة، الرسوم، زمن التوصيل.',
              'موقع المركز ونصف القطر على الخريطة.',
              'تفعيل/تعطيل المنطقة.',
              'تحديث الإحصائيات.',
            ],
          },
        ],
      },
      '/admin/system-audit': {
        title: 'سجل الرقابة والتدقيق (System Audit)',
        intro: 'نظام أمني يسجل كل حركة حساسة في النظام لضمان النزاهة ومنع التلاعب.',
        sections: [
          {
            title: 'ماذا يسجل النظام؟',
            bullets: [
              'تغييرات الأسعار (السعر القديم والجديد ومن قام بالتغيير).',
              'تعديلات المخزون اليدوية (غير الناتجة عن بيع/شراء).',
              'محاولات الدخول الفاشلة أو المشبوهة.',
              'تغييرات الصلاحيات للموظفين.',
            ],
          },
          {
            title: 'الخصائص الأمنية',
            bullets: [
              'سجل غير قابل للحذف (Immutable Logs): لا يمكن حتى للمدير مسح السجلات.',
              'التفاصيل الدقيقة: يسجل الوقت، عنوان IP، الجهاز، والمستخدم.',
              'استخدم هذا السجل عند وجود شك في تلاعب مالي أو إداري.',
            ],
          },
        ],
      },
      '/admin/expenses': {
        title: 'المصاريف التشغيلية',
        intro: 'تسجيل المصروفات اليومية (كهرباء، رواتب، صيانة) لخصمها من الأرباح.',
        sections: [
          {
            title: 'كيفية التسجيل',
            bullets: [
              'اضغط "إضافة مصروف" وحدد المبلغ والتاريخ.',
              'اختر الفئة (رواتب، إيجار، فواتير، نثرية).',
              'يمكن إرفاق ملاحظات أو رقم فاتورة المورد.',
            ],
          },
          {
            title: 'التأثير المالي',
            bullets: [
              'تُخصم هذه المصاريف من "مجمل الربح" للوصول إلى "صافي الربح".',
              'تظهر في تقرير الأرباح والخسائر (P&L) وتفاصيل التكاليف.',
              'لا تؤثر على تكلفة البضاعة (COGS) بل هي مصاريف عامة.',
            ],
          },
        ],
      },
      '/admin/challenges': {
        title: 'التحديات والجوائز (Gamification)',
        intro: 'نظام لتحفيز العملاء على الشراء المتكرر عبر تحديات ومكافآت.',
        sections: [
          {
            title: 'أنواع التحديات',
            bullets: [
              'تحدي الكمية: "اشترِ 5 وجبات واحصل على السادسة مجاناً".',
              'تحدي التنوع: "جرب 3 أصناف مختلفة من القائمة واحصل على رصيد".',
            ],
          },
          {
            title: 'الإدارة',
            bullets: [
              'يمكنك تحديد تاريخ بداية ونهاية للتحدي.',
              'تحديد الجائزة (نقاط ولاء أو رصيد محفظة).',
              'يظهر للمستخدم شريط تقدم في التطبيق (مثلاً: 3/5).',
            ],
          },
        ],
      },
      '/admin/customers': {
        title: 'إدارة العملاء',
        intro: 'قاعدة بيانات العملاء، التحكم في الحسابات، وإدارة الرصيد والنقاط.',
        sections: [
          {
            title: 'الإجراءات الإدارية',
            bullets: [
              'حظر عميل (Block): لمنعه من الطلب في حال تكرار المشاكل.',
              'تعديل الرصيد/النقاط: يمكن للمدير إضافة رصيد تعويضي (رضوة) أو خصم نقاط يدوياً.',
              'مراجعة سجل الطلبات: الاطلاع على تاريخ العميل الكامل لتقييم سلوكه الشرائي.',
            ],
          },
          {
            title: 'العملة المفضلة للعميل',
            bullets: [
              'حدد عملة العميل الافتراضية (اختياري) لتسهيل اختيار عملة المعاملة عند البيع وإظهار مبالغ واضحة للعميل.',
              'تغيير العملة المفضلة لا يغير عملة معاملات سابقة؛ هو تفضيل للاستخدام المستقبلي.',
              'يجب أن تكون العملة من العملات المعرفة في إعدادات النظام.',
            ],
          },
          {
            title: 'الخصوصية',
            bullets: [
              'بيانات العملاء الحساسة مشفرة.',
              'لا تشارك أرقام العملاء مع جهات خارجية.',
            ],
          },
          {
            title: 'الحقول والأزرار',
            bullets: [
              'بحث حسب الاسم/الهاتف.',
              'تفاصيل الحساب: الرصيد/النقاط/الحالة.',
              'أزرار الحظر/إلغاء الحظر، إضافة رصيد/خصم نقاط، عرض الطلبات.',
            ],
          },
        ],
      },
      '/admin/addons': {
        title: 'إدارة الإضافات (Add-ons)',
        intro: 'خيارات إضافية للمنتجات لزيادة قيمة الطلب وتخصيص التجربة.',
        sections: [
          {
            title: 'إعداد الإضافات',
            bullets: [
              'أنشئ مجموعة إضافات (مثلاً: "الإضافات").',
              'أضف الخيارات داخلها (مثلاً: "بيبسي +200"، "ماء +100").',
              'حدد السعر لكل خيار (يمكن أن يكون 0 للمجاني).',
            ],
          },
          {
            title: 'الربط بالمنتجات',
            bullets: [
              'اربط المجموعة بالمنتجات المناسبة (مثلاً: ربط "المشروبات" بمنتج "الأرز").',
              'حدد "إجباري" أو "اختياري" (مثلاً: اختيار نوع التغليف قد يكون إجبارياً).',
              'يمكن تحديد "حد أقصى" لعدد الاختيارات.',
            ],
          },
          {
            title: 'الأزرار والحقول',
            bullets: [
              'اسم المجموعة: تعريف واضح.',
              'خيار الإضافة: اسم/سعر/حجم (اختياري).',
              'حفظ/تعديل/حذف/تفعيل/تعطيل.',
              'ربط مع المنتجات: تحديد المنتجات المطبقة.',
            ],
          },
        ],
      },
      '/admin/reports': {
        title: 'مركز التقارير',
        intro: 'اختر نوع التقرير لعرض تحليلات مبيعات ومنتجات وعملاء.',
        sections: [
          {
            title: 'الأنواع',
            bullets: [
              'تقرير المبيعات: الإيرادات والطلبات والتحليلات.',
              'تقرير المنتجات: الأداء والأكثر مبيعًا والتنبيهات.',
              'تقرير العملاء: العملاء الأكثر نشاطًا والولاء.',
              'تقرير الحجوزات: الحجوزات المفتوحة حسب الطلب والمخزن.',
            ],
          },
          {
            title: 'الأزرار والخيارات',
            bullets: [
              'تحديد الفترات والنطاقات الزمنية.',
              'تصفية حسب منطقة/فئة/طريقة دفع.',
              'تصدير/طباعة عند توفر الصلاحيات.',
            ],
          },
        ],
      },
      '/admin/reports/sales': {
        title: 'تقرير المبيعات',
        intro: 'تحليل الإيرادات وعدد الطلبات ومتوسط السلة مع رسوم بيانية وتصدير.',
        sections: [
          {
            title: 'التحليلات',
            bullets: [
              'اختيار فترة زمنية/نطاق تاريخي لتحديث النتائج.',
              'رسوم بيانية مثل المبيعات حسب طريقة الدفع.',
              'خيارات تصدير وطباعة عند توفرها.',
              'تصفية النتائج حسب منطقة التوصيل لتحليل مخصص لكل منطقة.',
            ],
          },
        ],
      },
      '/admin/reports/products': {
        title: 'تقرير المنتجات',
        intro: 'عرض أداء المنتجات والأكثر مبيعًا وتنبيهات المخزون.',
        sections: [
          {
            title: 'ما الذي تراه؟',
            bullets: [
              'قوائم بالأصناف الأكثر مبيعًا.',
              'تنبيهات للأصناف منخفضة المخزون.',
            ],
          },
        ],
      },
      '/admin/reports/customers': {
        title: 'تقرير العملاء',
        intro: 'تحليل نشاط العملاء والإنفاق والولاء.',
        sections: [
          {
            title: 'المقاييس',
            bullets: [
              'أفضل العملاء حسب عدد الطلبات أو الإنفاق.',
              'تفاصيل الولاء والمستويات عند توفرها.',
            ],
          },
        ],
      },
      '/admin/reports/reservations': {
        title: 'تقرير الحجوزات',
        intro: 'عرض الحجوزات المفتوحة وربطها بالطلبات والمخازن والأصناف.',
        sections: [
          {
            title: 'ما الذي تراه؟',
            bullets: [
              'الطلبات غير المكتملة التي لديها حجوزات نشطة.',
              'الكمية المحجوزة لكل صنف داخل كل مخزن.',
              'آخر وقت تم تحديث الحجز (حجز/تحرير/خصم).',
            ],
          },
          {
            title: 'التصفية',
            bullets: [
              'تحديد الفترة الزمنية.',
              'تصفية حسب مخزن محدد أو كل المخازن.',
              'بحث بالعميل/الصنف/المخزن/رقم الطلب.',
            ],
          },
        ],
      },
      '/admin/login': {
        title: 'تسجيل دخول الإدارة',
        intro: 'الدخول إلى لوحة التحكم أو إعداد حساب المالك لأول مرة.',
        sections: [
          {
            title: 'الحالات',
            bullets: [
              'إذا كانت هذه أول مرة: ستظهر حقول إعداد حساب المالك وتأكيد كلمة المرور.',
              'بعد الإعداد: شاشة تسجيل دخول عادية باسم مستخدم وكلمة مرور.',
              'إذا ظهرت رسالة "بيانات خاطئة": تأكد من اسم المستخدم وكلمة المرور، أو اطلب إعادة تعيين من المالك.',
            ],
          },
        ],
      },
      '/admin': {
        title: 'لوحة التحكم',
        intro: 'هذه الصفحة تحويلية (Redirect) وتوجّهك تلقائيًا إلى أول شاشة مسموحة حسب صلاحياتك.',
        sections: [
          {
            title: 'كيف يعمل التحويل؟',
            bullets: [
              'إذا كنت تملك صلاحية لوحة القيادة سيتم توجيهك إلى “لوحة القيادة”.',
              'إذا لم تتوفر صلاحيات كافية، سيتم توجيهك لأقرب شاشة مسموحة (مثل الطلبات أو المستودعات).',
            ],
          },
          {
            title: 'في حال ظهرت صفحة فارغة',
            bullets: [
              'تحقق من تسجيل الدخول وصلاحيات المستخدم.',
              'إن استمرت المشكلة: أعد فتح التطبيق أو حدّث الصفحة.',
            ],
          },
        ],
      },
      '/help': {
        title: 'مركز المساعدة',
        intro: 'هنا يمكنك البحث عن شرح لكل صفحة في النظام حسب مكانك الحالي.',
        sections: [
          {
            title: 'كيف تستخدمه؟',
            bullets: [
              'اكتب كلمة في البحث لفلترة المواضيع.',
              'استخدم “العودة” للرجوع للصفحة التي طلبت المساعدة منها.',
              'زر المساعدة في أعلى أي صفحة يفتح لك شرح الصفحة الحالية مباشرة.',
            ],
          },
          {
            title: 'العملات المتعددة (Multi‑Currency)',
            bullets: [
              'أي مبلغ يجب أن يظهر ومعه عملته بشكل صريح؛ لا تعتمد على عملة ضمنية.',
              'عملة المعاملة (Transaction Currency) هي العملة الأساسية في العرض والإدخال داخل العملية نفسها (POS/شحنات/أوامر).',
              'العملة الأساسية (Base Currency) مخصصة للدفاتر والتقارير المالية؛ تُعرض عادةً كسطر إضافي للمرجعية عند الحاجة.',
              'الإعداد يبدأ من: الإعدادات › إعدادات العملة، ثم إدخال أسعار الصرف من: أسعار الصرف.',
              'راجع هذه الصفحات عند الحاجة: /admin/settings، /admin/fx-rates، /pos، /admin/import-shipments، /admin/customers، /admin/suppliers.',
            ],
          },
          {
            title: 'دليل الإدارة',
            bullets: [
              'قد يظهر وضع “دليل لوحة التحكم” لشرح شاشات الإدارة بشكل منفصل عن شاشات العميل.',
              'تختلف المواضيع حسب الصلاحيات والمسارات المتاحة في التطبيق.',
            ],
          },
        ],
      },
    };

    const hasSectionTitle = (t: HelpTopic | undefined, sectionTitle: string) => {
      return Boolean((t?.sections || []).some(s => s?.title === sectionTitle));
    };

    for (const [key, topic] of Object.entries(topics)) {
      if (!topic) continue;

      if (!hasSectionTitle(topic, 'الحقول والأزرار')) {
        const isAdmin = key.startsWith('/admin/') || key === '/admin' || key === '/pos' || key === '/admin/pos-test';
        const bullets = isAdmin
          ? [
            'قد تجد شريط بحث/فلاتر لتضييق النتائج (إن وُجد).',
            'قد تجد زر إضافة/جديد لإنشاء سجل جديد (إن وُجد).',
            'قد تظهر أزرار حفظ/تحديث/حذف حسب صلاحيات المستخدم.',
            'تعرض الشاشة رسائل نجاح/فشل عند تنفيذ أي عملية.',
          ]
          : [
            'زر الرجوع يعيدك للصفحة السابقة.',
            'قد يوجد زر إجراء رئيسي (مثل إضافة/تأكيد/حفظ) حسب الصفحة.',
            'قد توجد حقول إدخال/اختيار تُحدّث المحتوى مباشرة.',
            'تظهر رسائل تنبيه عند نقص بيانات أو حدوث خطأ.',
          ];
        topic.sections = [...(topic.sections || []), { title: 'الحقول والأزرار', bullets }];
      }

      if (key.startsWith('/admin/') && !hasSectionTitle(topic, 'الصلاحيات')) {
        topic.sections = [
          ...(topic.sections || []),
          {
            title: 'الصلاحيات',
            bullets: [
              'قد تختلف العناصر المتاحة حسب دورك وصلاحياتك (RBAC).',
              'إذا لم يظهر زر أو تبويب، غالبًا لا تملك الصلاحية المطلوبة.',
              'في حال رفض العملية: اطلب من المالك/المدير تفعيل الصلاحية المناسبة.',
            ],
          },
        ];
      }
    }

    return topics;
  }, []);

  const topicKey = normalizedFrom || (fromPath ? normalizePath(fromPath) : '');
  const topic = helpTopics[topicKey];

  const title = isAdminGuide
    ? 'دليل لوحة التحكم'
    : (topic?.title || 'مركز المساعدة');

  const intro = isAdminGuide
    ? 'ابحث داخل الدليل أو تصفح الأقسام لمعرفة الإعداد والتشغيل اليومي بدقة.'
    : (topic?.intro || 'اختر صفحة ثم اضغط زر المساعدة لعرض الشرح.');

  const suggestedTopics = useMemo(() => {
    const keys = Object.keys(helpTopics);
    keys.sort((a, b) => a.localeCompare(b));
    return keys.slice(0, 12).map(key => ({
      key,
      title: helpTopics[key]?.title || key,
    }));
  }, [helpTopics]);

  const adminTopics = useMemo(() => {
    if (!isAdminGuide) return [];

    const adminKeys = Object.keys(helpTopics)
      .filter(key => key.startsWith('/admin/'))
      .sort((a, b) => a.localeCompare(b));

    const normalizedQuery = normalizeSearchText(query);

    return adminKeys
      .map(key => {
        const topic = helpTopics[key];
        const title = topic?.title || key;
        const intro = topic?.intro || '';
        const sections = (topic?.sections || []).map(section => ({
          title: section.title,
          bullets: section.bullets,
        }));

        const allText = normalizeSearchText(
          [
            key,
            title,
            intro,
            ...sections.map(s => s.title),
            ...sections.flatMap(s => s.bullets),
          ]
            .filter(Boolean)
            .join(' '),
        );

        const matches = normalizedQuery ? allText.includes(normalizedQuery) : true;

        return {
          key,
          title,
          intro,
          sections,
          matches,
        };
      })
      .filter(entry => entry.matches);
  }, [helpTopics, isAdminGuide, query]);

  const backTarget = fromPath && fromPath.trim() ? fromPath : undefined;

  return (
    <div className="max-w-screen-2xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div className="animate-fade-in space-y-6">
        <div className="flex items-center justify-between gap-4">
          <button
            type="button"
            onClick={() => {
              if (backTarget) {
                navigate(backTarget);
                return;
              }
              navigate(-1);
            }}
            className="flex items-center text-sm font-semibold text-gray-600 dark:text-gray-300 hover:text-gold-500 dark:hover:text-gold-400 transition-colors gap-2"
            title="رجوع"
          >
            <BackArrowIcon className="w-5 h-5 transform rotate-180" />
            <span>رجوع</span>
          </button>

          <div className="text-sm text-gray-500 dark:text-gray-400 font-mono">
            {isAdminGuide ? '/admin' : fromPath ? normalizePath(fromPath) : ''}
          </div>
        </div>

        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 sm:p-8 border-2 border-gold-500/20">
          <h1 className="text-3xl font-bold dark:text-white">{title}</h1>
          <p className="mt-3 text-gray-600 dark:text-gray-300">{intro}</p>
        </div>

        {isAdminGuide && (
          <div className="space-y-4">
            <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-gray-200 dark:border-gray-700">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div className="md:col-span-2">
                  <label className="block text-sm font-semibold text-gray-700 dark:text-gray-200">
                    {'بحث داخل الدليل'}
                  </label>
                  <input
                    value={query}
                    onChange={(e) => setQuery(e.target.value)}
                    className="mt-2 w-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 px-4 py-3 text-gray-800 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-gold-500/50"
                    placeholder={'مثال: الإعدادات، المخزون، التقارير…'}
                  />
                </div>
                <div className="flex items-end">
                  <div className="w-full rounded-lg bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 px-4 py-3 text-sm text-gray-700 dark:text-gray-200">
                    {`النتائج: ${adminTopics.length}`}
                  </div>
                </div>
              </div>
            </div>

            <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-gray-200 dark:border-gray-700">
              <h2 className="text-xl font-bold text-gray-900 dark:text-white">
                {'البدء السريع (التهيئة قبل تشغيل التطبيق)'}
              </h2>
              <ul className="mt-4 space-y-2 text-gray-700 dark:text-gray-300">
                {[
                  'سجّل الدخول كمالك من صفحة تسجيل دخول الإدارة.',
                  'افتح الإعدادات واضبط بيانات المتجر والهوية وطرق الدفع والتوصيل.',
                  'أنشئ مناطق التوصيل وحدد الرسوم والحدود.',
                  'أضف الموردين ثم أنشئ الأصناف والإضافات وحدد الأسعار والوحدات وحالة الصنف.',
                  'أنشئ أوامر شراء للموردين ثم سجّل الاستلام لتحديث المخزون ومتوسط التكلفة.',
                  'راجع إدارة المخزون واضبط حدود التنبيه، ولا تعدّل الكميات يدويًا إلا للجرد/التسوية.',
                  'فعّل العروض/الإعلانات والكوبونات حسب الحاجة.',
                  'ابدأ استقبال الطلبات وراجع التقارير بشكل دوري.',
                ].map((text, idx) => (
                  <li key={idx} className="flex items-start gap-3">
                    <span className="mt-2 h-1.5 w-1.5 rounded-full bg-gold-500 flex-shrink-0" />
                    <span>{text}</span>
                  </li>
                ))}
              </ul>
            </div>

            <div className="space-y-4">
              {adminTopics.map((topic) => (
                <details key={topic.key} className="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 overflow-hidden" open={normalizeSearchText(query).length > 0}>
                  <summary className="cursor-pointer select-none px-6 py-4 flex items-center justify-between gap-4">
                    <div>
                      <div className="text-lg font-bold text-gray-900 dark:text-white">{topic.title}</div>
                      <div className="mt-1 text-xs text-gray-500 dark:text-gray-400 font-mono">{topic.key}</div>
                    </div>
                    <span className="text-sm text-gray-500 dark:text-gray-400">
                      {'فتح'}
                    </span>
                  </summary>
                  <div className="px-6 pb-6">
                    {topic.intro && <p className="text-gray-700 dark:text-gray-300">{topic.intro}</p>}
                    <div className="mt-4 space-y-4">
                      {topic.sections.map((section, idx) => (
                        <div key={`${topic.key}-${idx}`} className="rounded-lg border border-gray-200 dark:border-gray-700 p-4">
                          <h3 className="text-base font-bold text-gray-900 dark:text-white">{section.title}</h3>
                          <ul className="mt-3 space-y-2 text-gray-700 dark:text-gray-300">
                            {section.bullets.map((b, bIdx) => (
                              <li key={`${topic.key}-${idx}-${bIdx}`} className="flex items-start gap-3">
                                <span className="mt-2 h-1.5 w-1.5 rounded-full bg-gold-500 flex-shrink-0" />
                                <span>{b}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      ))}
                    </div>
                  </div>
                </details>
              ))}
            </div>
          </div>
        )}

        {!isAdminGuide && topic && (
          <div className="space-y-4">
            {topic.sections.map((section, idx) => (
              <div key={`${topicKey}-${idx}`} className="bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-gray-200 dark:border-gray-700">
                <h2 className="text-xl font-bold text-gray-900 dark:text-white">
                  {section.title}
                </h2>
                <ul className="mt-4 space-y-2 text-gray-700 dark:text-gray-300">
                  {section.bullets.map((b, bIdx) => (
                    <li key={`${topicKey}-${idx}-${bIdx}`} className="flex items-start gap-3">
                      <span className="mt-2 h-1.5 w-1.5 rounded-full bg-gold-500 flex-shrink-0" />
                      <span>{b}</span>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </div>
        )}

        {!isAdminGuide && !topic && (
          <div className="bg-white dark:bg-gray-800 rounded-lg shadow p-6 border border-gray-200 dark:border-gray-700">
            <div className="text-gray-700 dark:text-gray-300">
              {'لا يوجد شرح مخصص لهذه الصفحة بعد.'}
            </div>
            <div className="mt-4 flex flex-wrap gap-2">
              {suggestedTopics.map(({ key, title }) => (
                <Link
                  key={key}
                  to="/help"
                  state={{ from: key }}
                  className="px-3 py-2 rounded-lg border border-gold-500/30 hover:bg-gold-50 dark:hover:bg-gray-700 transition text-sm"
                >
                  {title}
                </Link>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default HelpCenterScreen;
